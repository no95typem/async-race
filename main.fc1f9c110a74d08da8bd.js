(()=>{"use strict";var e={3916:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});const r={garage:"_21SC4SGf5mTamWfNdNRR",garage__bg:"_2VnbeeG4HKnZfSWUedizHh","garage__track-container":"_1rsPT6UvHnbHI-FUFvPaSe","garage-bg":"-BA3r_cxZwAYkgGQVVZeo","garage-bg__video":"_3byu86MCf3s6B7JQuetNAw","garage-bg__car-ctl-btn":"_3upDU-ngLjybmFg4wiVvfl","garage-bg__car-ctl-block-number":"_3dT19pzigDW1UKuPVLEguq","garage-bg__car-ctl-block":"_2e0Ox8Joh0jw60ztR_rVt5","garage-bg__cars-ctls-block":"wMVLCRcoluFnZleBHWXlm","garage-bg__self-ctls-block":"_2VQVmkB2amN4PG9XCyFye9","garage-bg__pager":"_2avafWgl8XDS2KLJswKq0H","garage-bg__pager-span":"_3ktlpozBQghco3VMHLJBo1","garage-bg__pager-btn":"_2QdjLaEnj3Balh89eZAya4","synthwave-background":"_2pUKJme_w_0KTS_JoVNV5b","synthwave-background_intro":"OfV0nuAQOL-MWGdjOHOsE","move-grid":"_1MqERRNbzZtvdd9iE43L04","synthwave-background_race-mode":"n1z9UH35nfilmkK2lmQvV",race:"_375ItX4gjZY-ZT7KrEfBgG"}},6010:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});const r={"car-div":"_3pRKwGaRv59JcJqlApAnkk","car-div__canvas":"rH6_OMXna8-zeemMHF11D","car-div__wheel":"_3WNDl-LGGtViqzAfLLX4CB","car-div__wheel_forward":"_3Rdh32fs7fi-95LcabV_Ed","car-div__wheel_backward":"_3xptMXOOFn6YcMVYMigRMa","car-div__explosion":"_3w8-mlW0m2zLABohqiDQ3e","car-div_rollForward":"_3xWmq3Q2UpNiq2nICrGAIN","car-div-anim":"_381V-1xCMVwSdGT0FxnQiO","tire-anim":"_2Qs9DAZPIqZivw_0ON2Vot"}},2022:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});const r={root:"_2uo9WXSTJyDD3jBlT_quev","text-input":"_2YNdYEaErpy02Ske_bZONx","color-input":"_3Ye7rbfoBnq4HZn4H-yDB8"}},7715:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});const r={"main-controls":"_2b_svto1O0DGSO3_579_Xj","btn-block":"_262VSHreYXfZUHLGeCJEvZ"}},2096:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});const r={track:"_2hDrLwwwZMiv2NrI-XZZqJ",track_illuminated:"_3zXlLAoKpXJ_jlpauHLjHR","track__controls-block":"_3pqcODoHFqX9rxmLKBnhD4"}},3544:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});const r={header:"_3TTTWNe5aoHesw4iV0YUGU",header__logo:"_2idUQTZia_1M_0xkhMkXf8","header-nav":"_7vejZGT8OzUejTiWyGs1P","header-nav__item":"_1NYwlHRXmh2YGu63soBsjx","header-nav__anchor":"_2n39qEg5Iz5Tym2Z0Jrjz9","header-nav__anchor_active":"_2bRvd3RlExbbSpyXLuxSdS","header-nav__svg":"_2FCXcgNK7Jgl9f3ZK-O56I","header-nav__span":"_1NVrpdaSQLvqho4VNqQqit","header-nav__list":"_1vy8OijKt-Cy7SGXyM4ek9","header-nav__list_disabled":"_25SilQm6mkAlbl-WpajKBY"}},9052:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});const r={winners:"HVDfoBgyIQ4teF5EKFzcD",table:"_3mJKnd573Tt4WspNl7gf1J","table__car-preview-box":"_86kcZK8UgXIsvYD-wpDED","table__can-be-sorted":"_3Xa74hpyx3g6XUuZ9fB9Cm","table__sorted-elem":"rfPuVNCW0Sd4nzQGO8-R8","table__sorted-elem_asc":"N6296gY2c5AFEX4KjE4I4","table__sorted-elem_desc":"_37bMOUs2OF28ZqMubJCPnM",pager:"_2q-noyJbwIpKOMhl7AWlq5","pager-span":"_1O8erRuDz9RWa3C9tqnUm-","pager-btn":"_3OktYstRgXgDE6zlpOM6LA"}},3588:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});const r={"popup-modal":"_3KlZOyoPt2P4FT1Ofdi1oz","popup-bg":"_1QGzfQYEHvrYonFptRzkG6","popup-body":"_3zDyJwNy615xogiYvCl4vt","popup-body-header":"_2DglTs5KJlA1QJriRI6bVZ","popup-body-text":"_2oMxBL_Jv1KW3bHu3sVdaA","popup-body__btn-close":"HV1Imp7Np5N8O5nUXwQsS"}},9715:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});const r={container:"_1KBIW4BNGKHwQtRcKc6JIF","hue-rotate":"_1t6lrd-wEBCB6ei-o9kDmk",bar:"_2DWg3PnmWwM25SBd7sLJQK",body:"_24wm1l_qZHsMTx2Oy-enF4",text:"_1UFV3thankQQ1R2Ly1Zle2"}},6725:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});const r={app:"_2ljk-3_Qk7EjDct5a15qZP","main-component":"_394erWdWCWrQmkYlaBZ1L5",btn:"_3cliA46UjEIGfEKGRnJzCZ","btn-1":"_7q7sGuJSjnM-fV8DfMtl5","btn-4":"KE9Fso9VtLV8xX_x8IAiF","btn-6":"_35BryCkuNmCUsRxmBw_Y1","btn-9":"_9jiLaDmXVuzxrmO3P-9mb","btn-13":"_1872fOtVBrHuR0iXYtVhRT","btn-15":"TNTO3dtfSfS40M6g8U274","glitched-text":"xB_2phBrodgB6jPUYYf8V","glitch-animation-1":"_2N8U2GaQpCAdpuVv32CY9B","glitch-animation-2":"_1g8DjVAkpXimf-Ld9-LLk8"}},6752:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const a=s(1209),n=s(5207),o=s(7172),i=s(7950),c=s(4690),d=s(2994),l=s(4977),h=r(s(6725)),u=s(8785),_=s(7656),p=s(5856),E=s(3287),g=s(3231),m=s(9630);t.App=class{constructor(e){this.rootElement=e,this.hubName=p.DBUS_HUB_NAMES.APP,this.loadedMainComponents={},this.defaultRouterAgent=new a.SimpleRouterAgent("hash","",(()=>this.loadMainComponent("default"))),this.router=new n.SimpleRouter({mode:"#",defaultRoot:"",defaultAgent:this.defaultRouterAgent}),this.mainlineDBus=new o.DBus,this.watchRouterMsgs=async e=>{const{msg:t}=e;return t instanceof i.DBusMsgRouteIsChangedMsg&&this.loadMainComponent(t.newRoute),d.DBUS_COMMON_RESPONSES.VOID},window.addEventListener("error",(e=>console.log(e))),window.addEventListener("unhandledrejection",(e=>{e.preventDefault(),e.promise.catch((e=>{e.message in g.REST_CLIENT_ERROR&&console.log(e.message)}))})),this.rootElement.classList.add(h.default.app);const t=new l.HeaderComponent(p.DBUS_HUB_NAMES.HEADER);this.rootElement.append(t.rootElement),this.mainlineDBus.attachHub(t),this.mainlineDBus.attachHub(this),this.mainlineDBus.attachHub(this.router),this.router.activateWantedAgents()}connect(e){const t=e.getNewRX(this.watchRouterMsgs);e.plugRX(c.DBusTopics.ROUTING,t)}loadMainComponent(e){if(!(e in this.loadedMainComponents))switch(e){case"#garage":this.loadedMainComponents[`${e}`]=new u.GarageComp;break;case"#winners":this.loadedMainComponents[`${e}`]=new E.WinnersComp;break;default:window.location.hash="#garage"}const t=this.loadedMainComponents[`${e}`];if(t){if(this.currMainComponent&&this.currMainComponent.rootElement.remove(),this.currMainComponent=t,t.rootElement.classList.add(h.default["main-component"]),this.rootElement.append(t.rootElement),_.isDBusHub(this.currMainComponent))try{this.mainlineDBus.attachHub(this.currMainComponent)}catch{}m.isNotifiable(this.currMainComponent)&&(console.log("notify"),this.currMainComponent.notify(null))}}}},1069:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.CarActions=void 0,(s=t.CarActions||(t.CarActions={}))[s.CREATED=0]="CREATED",s[s.SELECTED=1]="SELECTED",s[s.REMOVED=2]="REMOVED",s[s.UPDATED=3]="UPDATED"},2223:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgCarActionMsg=void 0;const r=s(4690),a=s(7469);class n extends a.DBusMsg{constructor(e,t,s){super(r.DBusTopics.CAR_ACTION,t,s),this.action=e,this.rxIds=t,this.prefResponseRxIds=s}}t.DBusMsgCarActionMsg=n},9237:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgCarActionCreatedMsg=void 0;const r=s(1069),a=s(2223);class n extends a.DBusMsgCarActionMsg{constructor(e,t,s){super(r.CarActions.CREATED,t,s),this.car=e,this.rxIds=t,this.prefResponseRxIds=s}}t.DBusMsgCarActionCreatedMsg=n},8577:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgCarActionRemovedMsg=void 0;const r=s(1069),a=s(2223);class n extends a.DBusMsgCarActionMsg{constructor(e,t,s,a){super(r.CarActions.REMOVED,s,a),this.car=e,this.nullifiedContract=t,this.rxIds=s,this.prefResponseRxIds=a}}t.DBusMsgCarActionRemovedMsg=n},6911:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgCarActionSelectedMsg=void 0;const r=s(1069),a=s(2223);class n extends a.DBusMsgCarActionMsg{constructor(e,t,s,a){super(r.CarActions.SELECTED,s,a),this.car=e,this.notifyChanges=t,this.rxIds=s,this.prefResponseRxIds=a}}t.DBusMsgCarActionSelectedMsg=n},9565:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgGarageRaceMsg=void 0;const r=s(4690),a=s(7469);class n extends a.DBusMsg{constructor(e,t){super(r.DBusTopics.GARAGE,e,t),this.rxIds=e,this.prefResponseRxIds=t}}t.DBusMsgGarageRaceMsg=n},9362:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgRaceRequestMsg=void 0;const r=s(9565);class a extends r.DBusMsgGarageRaceMsg{constructor(e,t){super(e,t),this.rxIds=e,this.prefResponseRxIds=t}}t.DBusMsgRaceRequestMsg=a},3018:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgGarageRaceStatusMsg=void 0;const r=s(9565);class a extends r.DBusMsgGarageRaceMsg{constructor(e,t,s){super(t,s),this.status=e,this.rxIds=t,this.prefResponseRxIds=s}}t.DBusMsgGarageRaceStatusMsg=a},7977:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgGarageResetMsg=void 0;const r=s(4690),a=s(7469);class n extends a.DBusMsg{constructor(e,t){super(r.DBusTopics.GARAGE,e,t),this.rxIds=e,this.prefResponseRxIds=t}}t.DBusMsgGarageResetMsg=n},3102:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgGarageResetReqMsg=void 0;const r=s(7977);class a extends r.DBusMsgGarageResetMsg{constructor(e,t){super(e,t),this.rxIds=e,this.prefResponseRxIds=t}}t.DBusMsgGarageResetReqMsg=a},4768:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GarageComponentControllerAkaDirector=void 0;const a=s(2994),n=s(5856),o=s(4690),i=s(379),c=s(8577),d=s(8856),l=s(8990),h=s(1598),u=s(9237),_=s(9362),p=s(3102),E=r(s(3916)),g=r(s(6725)),m=s(7612);class R{constructor(e,t){this.tracksContainer=e,this.carCtlsBlock=t,this.hubName=n.DBUS_HUB_NAMES.GARAGE_CONTROLLER,this.txs=new Set,this.entriesPerPage=7,this.pagerContainer=document.createElement("div"),this.carImgRatio=3.78,this.scaleFactor=.95,this.pagerCallback=async e=>{try{return await this.reloadData(e),!0}catch{return!1}},this.racingRXFunc=async e=>e.msg instanceof _.DBusMsgRaceRequestMsg?(this.pager.toogleLock(!0),await this.performRace(),this.pager.toogleLock(!1),!0):e.msg instanceof p.DBusMsgGarageResetReqMsg?this.resetState():a.DBUS_COMMON_RESPONSES.VOID,this.carActionsRXFunc=async e=>{if(e.msg instanceof c.DBusMsgCarActionRemovedMsg||e.msg instanceof u.DBusMsgCarActionCreatedMsg)try{this.reloadData("no")}catch{this.pager.tryChangePage("prev")}return a.DBUS_COMMON_RESPONSES.VOID},this.createCarCtlBlock=(e,t)=>{const s=[e.btnSelect,e.btnStart,e.btnReset,e.btnRm];e.btnStart.classList.add(g.default["btn-15"]),e.btnSelect.classList.add(g.default["btn-13"]),e.btnReset.classList.add(g.default["btn-9"]),e.btnRm.classList.add(g.default["btn-4"]),s.forEach((e=>{e.classList.add(g.default.btn,E.default["garage-bg__car-ctl-btn"])}));const r=document.createElement("span");r.classList.add(E.default["garage-bg__car-ctl-block-number"]),r.textContent=t.toString();const a=document.createElement("div");return a.classList.add(E.default["garage-bg__car-ctl-block"]),a.append(r,...s),a},this.connectCtlAndTrack=(e,t)=>{e.addEventListener("mouseover",(()=>t.illuminateSelf(!0)),!0),e.addEventListener("mouseout",(e=>{console.log(e),t.illuminateSelf(!1)}),!0)},this.garageManagersTeam=new d.GarageManagersTeam(e,t),this.pagerContainer.classList.add(E.default["garage-bg__pager"]),this.pager=new m.Pager(this.entriesPerPage,this.pagerCallback);const s=this.pager.getBtnNextPage(),r=this.pager.getBtnPrevPage();s.classList.add(g.default.btn,g.default["btn-6"],E.default["garage-bg__pager-btn"]),r.classList.add(g.default.btn,g.default["btn-6"],E.default["garage-bg__pager-btn"]);const o=this.pager.getPagerSpan();o.classList.add(E.default["garage-bg__pager-span"]),this.pagerContainer.append(r,s,o)}startWorking(){this.reloadData("no"),window.addEventListener("resize",(()=>this.redraw()))}async connect(e){this.txs.add(e.getNewTX("send requests to REST Garage client")),this.garageManagersTeam.autoConnect(e);const t=e.getNewRX(this.carActionsRXFunc,"monitor cars removes");e.plugRX(o.DBusTopics.CAR_ACTION,t);const s=e.getNewRX(this.racingRXFunc,"handle race requsets");e.plugRX(o.DBusTopics.GARAGE,s)}async resetState(){return await this.garageManagersTeam.resetState()}async performRace(){await this.garageManagersTeam.performRace()}reloadData(e){return new Promise(((t,s)=>{const r=e?"next"===e?this.pager.getCurrPageNumber()+1:"prev"===e?this.pager.getCurrPageNumber()-1:"no"===e?this.pager.getCurrPageNumber():1:1;i.REST_CLIENT_GARAGE.getCars(r,this.pager.getEntriesPerPage()).then((async e=>{const{limit:r,cars:a}=e;if(this.pager.setEntriesCount(Number.parseInt(r,10)),0===a.length)return void s();await this.garageManagersTeam.nullifyContracts();const n=[];a.forEach(((e,t)=>{const s=new h.TrackComp,r=new l.CarComp(e,t+1);s.placeCar(r),n.push({track:s,car:r})})),this.garageManagersTeam.addContracts(...n),this.garageManagersTeam.resetState(),this.redraw(),t(!0)})).catch((()=>{}))}))}redraw(){this.clearDOM(),[...this.garageManagersTeam.getContracts()].map((e=>e.track));const e=this.calcGeometry();this.setStylesForTracks(e),this.drawTracks(),this.drawCarsCtls()}clearDOM(){for(;this.tracksContainer.firstChild;)this.tracksContainer.firstChild.remove();for(;this.carCtlsBlock.firstChild;)this.carCtlsBlock.firstChild.remove()}calcGeometry(){const e=window.getComputedStyle(this.tracksContainer),t=Number.parseFloat(e.height)-Number.parseFloat(e.paddingBottom)-Number.parseFloat(e.paddingTop),s=.2*window.innerWidth/this.carImgRatio,r=[];let a=0;const n=[...this.garageManagersTeam.getContracts()];n.forEach(((e,t)=>{const n=this.scaleFactor**t,o=s*n;a+=o,r.push(o)}));const o=a-t,i=r.sort(((e,t)=>e-t)),c=o>0?o/this.garageManagersTeam.getContracts().size-2:0,d=[],l=(n.length-1)/2;n.forEach(((e,t)=>{const s=c*-(t-l)+R.DISPLACEMENT_FIX;d.push(s)}));const h=i[0]*this.carImgRatio,u=20*window.innerWidth/1920;return{trackHeights:i,displacements:d,paddingBase:h,paddingAddShift:u}}setStylesForTracks(e){const t=[...this.garageManagersTeam.getContracts()];t.forEach(((s,r)=>{s.track.rootElement.style.setProperty("height",`${e.trackHeights[r]}px`),s.track.rootElement.style.setProperty("top",`${e.displacements[r]}px`),s.track.rootElement.style.setProperty("z-index",`${r+1}`),s.track.rootElement.style.setProperty("--padding-w",e.trackHeights[e.trackHeights.length-1-r]*this.carImgRatio-e.paddingBase+e.paddingAddShift*(t.length-1-r)+"px")}))}drawTracks(){this.tracksContainer.append(this.pagerContainer,...[...this.garageManagersTeam.getContracts()].map((e=>e.track.rootElement)))}drawCarsCtls(){const e=[...this.garageManagersTeam.getContracts()].map(((e,t)=>{const s=this.createCarCtlBlock(e.car,t+1);return this.connectCtlAndTrack(s,e.track),s}));this.carCtlsBlock.append(...e)}}t.GarageComponentControllerAkaDirector=R,R.DISPLACEMENT_FIX=-20},1294:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GarageDriver=t.GarageDriverCommands=void 0;const r=s(4590),a=s(9461);var n;(n=t.GarageDriverCommands||(t.GarageDriverCommands={}))[n.START_DRIVING=0]="START_DRIVING",n[n.STOP_DRIVING=1]="STOP_DRIVING";class o{isFree(){return!this.contract}putBehindTheWheel(e){if(this.contract)throw new Error("ALREADY IN CAR");this.contract=e}async getOutOfTheCar(){this.contract=void 0}async performDrivingProtocol(e){return new Promise(((t,s)=>{const a=r.genUniqId();this.currDriveId=a,this.TurnOnTheIgnition().then((r=>{a!==this.currDriveId&&s(new Error("interrupted")),console.log(r);const n=this.drive(r,a,e);t({driveParams:r,drivePromise:n})})).catch((e=>{a!==this.currDriveId?s(new Error("interrupted")):s(e)}))}))}async TurnOnTheIgnition(){if(!this.contract)throw new Error("NOT_BEHIND_THE_WHEEL");const e=await a.REST_CLIENT_ENGINE.toggleEngine(this.contract.car.currCar.id,"started");return console.log("ENGINE STARTED"),e}async returnToStart(){return this.currDriveId=void 0,await this.stopCar(),new Promise(((e,t)=>{if(this.contract){const t=1;this.contract.car.rollBack(t).then((()=>e(!0)))}}))}async drive(e,t,s){return new Promise(((r,n)=>{if(this.contract){const{contract:i}=this,c=o.calculateDriveTime(e);a.REST_CLIENT_ENGINE.enterDriveMode(i.car.currCar.id).then((()=>{i===this.contract&&t===this.currDriveId?(console.log("stop car finish"),this.stopCar(),r(c)):n(new Error("interrupted"))})).catch((()=>{i===this.contract&&t===this.currDriveId?(console.log("stop car broken"),this.stopCar(!0,s),n(new Error("BROKEN"))):n(new Error("interrupted"))})),i.car.rollForward(c).then((()=>{i===this.contract&&t===this.currDriveId?(console.log("stop car finish by animation"),this.stopCar(),r(c)):n(new Error("interrupted"))})).catch((()=>{i===this.contract&&t===this.currDriveId?(console.log("stop car anim cancel by car"),this.stopCar(!0,s),n(new Error("BROKEN"))):n(new Error("interrupted"))}))}else n(new Error("No car"))}))}async stopCar(e,t){if(this.contract)try{const s=await a.REST_CLIENT_ENGINE.toggleEngine(this.contract.car.currCar.id,"stopped");return console.log("stopped by server",s),this.contract.car.stop(e,t),!0}catch{return!1}}static calculateDriveTime(e){return e.distance/1e3/e.velocity}}t.GarageDriver=o},8856:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GarageManagersTeam=void 0;const a=s(745),n=s(6911),o=s(379),i=s(8577),c=s(1294),d=s(4590),l=r(s(3916)),h=s(928),u=s(3231),_=s(3018);t.GarageManagersTeam=class{constructor(e,t){this.tracksContainer=e,this.carCtlsBlock=t,this.txs=new Set,this.contracts=new Set,this.freeDrivers=new Set,this.busyDrivers=new Map,this.carCtlsClickListener=e=>{if(e.target instanceof HTMLElement){const t=e.target;let s;t instanceof HTMLButtonElement?s=e.target:t.parentElement instanceof HTMLButtonElement&&(s=t.parentElement),s&&this.contracts.forEach((e=>{this.currRaceId||(s===e.car.btnSelect&&this.handleSelection(e),s===e.car.btnRm&&this.handleRemoving(e),s===e.car.btnStart&&this.startDriving(e),s===e.car.btnReset&&this.handleRestoreState(e))}))}},this.handleWinner=(e,t)=>{const s=e.car.currCar;h.REST_CLIENT_WINNERS.getWinner(s.id).then((e=>{const s={id:e.id,wins:e.wins+1,time:t<e.time?Number.parseFloat(t.toFixed(2)):e.time};h.REST_CLIENT_WINNERS.updateWinner(s)})).catch((e=>{if(e.message===u.REST_CLIENT_ERROR.NOT_FOUND){const e={id:s.id,wins:1,time:Number.parseFloat(t.toFixed(2))};h.REST_CLIENT_WINNERS.createWinner(e)}}))},this.carCtlsBlock.addEventListener("click",this.carCtlsClickListener)}autoConnect(e){const t=e.getNewTX("garage serviceman");this.txs.add(t)}getContracts(){return this.contracts}async nullifyContracts(e){e?(this.tryFreeDrivers(...e),e.forEach((e=>{this.contracts.delete(e)}))):(this.tryFreeDrivers(...this.contracts),this.contracts.clear())}addContracts(...e){e.forEach((e=>this.contracts.add(e)))}async resetState(e){e||(this.currRaceId=void 0),this.tracksContainer.classList.remove(l.default["synthwave-background_race-mode"]),await this.rollbackCars(),e||this.broadcastRaceStatus("READY_TO_GO")}async handleRestoreState(e){const t=this.busyDrivers.get(e);t&&await t.returnToStart()}async startDriving(e,t){let s=this.busyDrivers.get(e);return s||(s=[...this.freeDrivers].find((e=>e.isFree())),s?this.freeDrivers.delete(s):s=new c.GarageDriver,this.busyDrivers.set(e,s),s.putBehindTheWheel(e)),await s.performDrivingProtocol(t).catch((e=>e))}handleRemoving(e){o.REST_CLIENT_GARAGE.deleteCar(e.car.currCar.id).then((async()=>{await h.REST_CLIENT_WINNERS.deleteWinner(e.car.currCar.id).catch((()=>{})),this.tryFreeDrivers(e),this.contracts.delete(e);const t=new i.DBusMsgCarActionRemovedMsg(e.car.currCar,e);this.txs.forEach((e=>{e.transmit({msg:t,prepMode:a.DBusTXPrepModes.freeze,waitMode:a.DBusTXWaitModes.nowait})}))}))}handleSelection(e){const t=new n.DBusMsgCarActionSelectedMsg(e.car.currCar,this.genSelectCallback(e));this.txs.forEach((e=>{e.transmit({msg:t,prepMode:a.DBusTXPrepModes.freeze,waitMode:a.DBusTXWaitModes.nowait})}))}async rollbackCars(){this.tracksContainer.style.setProperty("--translate-x","0px");const e=[];this.busyDrivers.forEach((t=>{e.push(t.returnToStart())})),await Promise.all(e)}async performRace(){const e=d.genUniqId();if(this.currRaceId=e,await this.resetState(!0),e!==this.currRaceId)return;const t={raceId:e,arrivedByOrder:[],notArrived:[],participantsCount:this.contracts.size,flags:{isFinishVisible:!1},stratedCount:0};this.broadcastRaceStatus("IN_PROCESS"),await this.processRace(t).catch((t=>{if(e===this.currRaceId)throw t})).finally((()=>{this.tracksContainer.classList.remove(l.default["synthwave-background_race-mode"])})),e===this.currRaceId&&(console.log(t),this.broadcastRaceStatus("NEED_RESET"))}broadcastRaceStatus(e){const t=new _.DBusMsgGarageRaceStatusMsg(e);this.txs.forEach((e=>{e.transmit({msg:t,prepMode:a.DBusTXPrepModes.freeze,waitMode:a.DBusTXWaitModes.nowait})}))}processRace(e){return new Promise((t=>{this.contracts.forEach((s=>{this.startDriving(s,e.flags).then((r=>{if(e.raceId===this.currRaceId){if(e.stratedCount===e.participantsCount-1?this.tracksContainer.classList.add(l.default["synthwave-background_race-mode"]):e.stratedCount++,r instanceof Error)throw r;r.drivePromise.then((t=>this.handleDriveResult(e,s,t))).catch((r=>{"interrupted"===r.message&&t(!1),e.notArrived.push(s)})).finally((()=>{e.arrivedByOrder.length+e.notArrived.length===e.participantsCount&&t(e)}))}else t(!1)}))}))}))}handleDriveResult(e,t,s){e.raceId===this.currRaceId&&!1!==s&&(0===e.arrivedByOrder.length&&(e.flags.isFinishVisible=!0,this.tracksContainer.classList.remove(l.default["synthwave-background_race-mode"]),this.handleWinner(t,s)),e.arrivedByOrder.push(t))}tryFreeDrivers(...e){e.forEach((e=>{const t=this.busyDrivers.get(e);t&&t.getOutOfTheCar().then((()=>{this.busyDrivers.delete(e),this.freeDrivers.add(t)}))}))}genSelectCallback(e){return t=>{this.contracts.has(e)&&e.car.updateData(t)}}}},8785:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GarageComp=void 0;const a=s(1168),n=s(5856),o=s(4768),i=s(44),c=r(s(3916));class d extends a.BaseComp{constructor(){super("section"),this.hubName=n.DBUS_HUB_NAMES.GARAGE,this.mainControlsComp=new i.MainControlsComp,this.carsCtlsBlock=document.createElement("div"),this._rootElement.classList.add(c.default.garage);const e=document.createElement("div");e.classList.add(c.default["garage__track-container"],c.default["synthwave-background"]);const t=document.createElement("div");t.classList.add(c.default["garage-bg__self-ctls-block"]),t.append(this.mainControlsComp.rootElement);const s=document.createElement("div");s.classList.add(c.default.garage__bg,c.default["garage-bg"]);const r=document.createElement("video");r.classList.add(c.default["garage-bg__video"]),r.controls=!1,r.loop=!0,r.defaultMuted=!0,r.muted=!0,r.autoplay=!0,r.src="./assets/videos/bg/cyberpunk2077-garage.mp4",this.controller=new o.GarageComponentControllerAkaDirector(e,this.carsCtlsBlock),r.onloadeddata=()=>{console.log("loaded"),this.controller.startWorking()},this.carsCtlsBlock.classList.add(c.default["garage-bg__cars-ctls-block"]),s.append(r,t),this._rootElement.append(s,e,this.carsCtlsBlock)}connect(e){e.attachSubHub(this.controller),e.attachSubHub(this.mainControlsComp)}}t.GarageComp=d},8990:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CarComp=void 0;const a=s(1168),n=s(9007),o=s(5094),i=r(s(6010));class c extends a.BaseComp{constructor(e,t){super("div"),this._currCar=e,this.canvas=document.createElement("canvas"),this.tireBack=document.createElement("img"),this.btnSelect$=document.createElement("button"),this.btnRm$=document.createElement("button"),this._spanCarName=document.createElement("span"),this.btnStart$=document.createElement("button"),this.btnReset$=document.createElement("button"),this._rootElement.classList.add(i.default["car-div"]),this.canvas.classList.add(i.default["car-div__canvas"]),this._rootElement.append(this.canvas);const s=document.createElement("span"),r=document.createElement("span"),a=document.createElement("span"),n=document.createElement("span");s.textContent="select",r.textContent="remove",a.textContent="start!",n.textContent="reset",this.btnSelect$.append(s),this.btnRm$.append(r),this.btnReset$.append(n),this.btnStart$.append(a),this.btnReset$.disabled=!0,console.log(this.btnReset$.disabled),this._spanCarName.textContent=`${t}: ${e.name}`,c.drawCar(this.canvas,this._currCar.color),c.drawWheels(this._rootElement)}static drawWheels(e){const t=new Image;t.src=c.CAR_WHEEL_IMG_SRC,t.onload=()=>{t.classList.add(i.default["car-div__wheel"]);const s=o.OBJ_PROCESSOR.deepClone(t);t.classList.add(i.default["car-div__wheel_forward"]),s.classList.add(i.default["car-div__wheel_backward"]),e.append(t),e.append(s)}}updateData(e){this._currCar=e,c.drawCar(this.canvas,this._currCar.color)}async rollBack(e){return new Promise((e=>{this.currAnimation?(this.currAnimation.playbackRate=-10,this.currAnimation.play(),this.currAnimation.onfinish=()=>{const t=this.currAnimation;"commitStyles"in t&&"function"==typeof t.commitStyles&&t.commitStyles(),this.currAnimation=void 0,this._rootElement.classList.remove(i.default["car-div_rollForward"]),this.stop(),console.log("finish listener rollback"),this.btnStart$.disabled=!1,this.btnReset$.disabled=!0,this.btnRm$.disabled=!1,this.btnSelect$.disabled=!1,e(!0)}):e(!1)}))}async rollForward(e){return new Promise(((t,s)=>{this.btnStart$.disabled=!0,this.btnRm$.disabled=!0,this.btnSelect$.disabled=!0,this.btnReset$.disabled=!1;const r=window.getComputedStyle(this._rootElement.parentElement),a=window.getComputedStyle(this.rootElement),n=Number.parseFloat(r.width)-Number.parseFloat(r.paddingLeft)-Number.parseFloat(r.paddingRight),o=Number.parseFloat(a.width),c=(n-o)/o*100;this._rootElement.classList.add(i.default["car-div_rollForward"]),this.currAnimation=this._rootElement.animate([{transform:`translateX(${c}%)`}],{duration:1e3*e,easing:"ease-in-out",fill:"forwards"}),this.currAnimation.onfinish=()=>{this._rootElement.classList.remove(i.default["car-div_rollForward"]),this.stop(),console.log("finish listener"),t(!0)},this.currAnimation.oncancel=()=>{this._rootElement.classList.remove(i.default["car-div_rollForward"]),console.log("cancelled anim"),s()}}))}stop(e,t){if(this.rootElement.style.setProperty("transition",""),this._rootElement.classList.remove(i.default["car-div_rollForward"]),console.log("pause anim"),this.currAnimation?.pause(),e){console.log(e),t?.isFinishVisible;const s=new Image;let r=0;s.classList.add(i.default["car-div__explosion"]),s.src=`${c.CAR_EXPLOSION_IMG_DATA.BASE_URL}${r}${c.CAR_EXPLOSION_IMG_DATA.EXTENSION}`,s.onload=async()=>{this._rootElement.append(s),await new Promise((e=>setTimeout(e,c.CAR_EXPLOSION_IMG_DATA.FRAME_TIME_MS))),r++,r<c.CAR_EXPLOSION_IMG_DATA.FRAMES_COUNT?s.src=`${c.CAR_EXPLOSION_IMG_DATA.BASE_URL}${r}${c.CAR_EXPLOSION_IMG_DATA.EXTENSION}`:s.remove()}}}get currCar(){return this._currCar}get btnSelect(){return this.btnSelect$}get btnRm(){return this.btnRm$}get btnStart(){return this.btnStart$}get btnReset(){return this.btnReset$}get spanCarName(){return this._spanCarName}static drawCar(e,t){const s=new Image;s.src=c.CAR_BODY_IMG_SRC,s.onload=()=>{e.height=s.height/3,e.width=s.width/3;const r=e.getContext("2d");r&&(r.shadowColor=t,r.shadowBlur=25,r.drawImage(s,0,0,e.width,e.height)),c.paintCarBody(e,t)}}static paintCarBody(e,t){const s=e.getContext("2d")?.getImageData(0,0,e.width,e.height);if(s){const r=n.hexToRgb(t);for(let e=0;e<s.width;e++)for(let t=0;t<s.height;t++){const a=4*t*s.width+4*e,n=s.data[a],o=s.data[a+1],i=s.data[a+2],c=2*i-n-o,d=10,l=70;n>l&&o>l&&i>l&&c<d&&(s.data[a]=n/255*r.r,s.data[a+1]=o/255*r.g,s.data[a+2]=i/255*r.b)}e.getContext("2d")?.putImageData(s,0,0,0,0,e.width,e.height)}}static genPreview(e){const t=document.createElement("div"),s=document.createElement("canvas");return s.classList.add(i.default["car-div__canvas"]),t.append(s),c.drawWheels(t),c.drawCar(s,e.color),t}}t.CarComp=c,c.TIMING_FUNCTION="cubic-bezier(.72,.2,.54,.77)",c.CAR_BODY_IMG_SRC="./assets/imgs/cars/body.gif",c.CAR_WHEEL_IMG_SRC="./assets/imgs/cars/tire back.gif",c.CAR_EXPLOSION_IMG_DATA={BASE_URL:"./assets/imgs/cars/explosion/",EXTENSION:".png",FRAMES_COUNT:9,FRAME_TIME_MS:200}},4312:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CreateCompController=void 0;const r=s(745),a=s(379),n=s(9237),o=s(8982);class i extends o.CreateUpdateCompControllerProto{constructor(e){super(e.inputText,e.inputColor,e.btn),this.txs=new Set,this.setupBtnCreate()}setupBtnCreate(){this.btn.addEventListener("click",(()=>{this.btn.disabled=!0;const e={name:this.inputText.value,color:this.inputColor.value};a.REST_CLIENT_GARAGE.createCar(e).then((e=>{const t=new n.DBusMsgCarActionCreatedMsg(e);this.txs.forEach((e=>{e.transmit({msg:t,prepMode:r.DBusTXPrepModes.clone,waitMode:r.DBusTXWaitModes.nowait})}))})).finally((()=>{this.btn.disabled=!1}))}))}autoConnect(e){const t=e.getNewTX("send created car msgs");this.txs.add(t)}}t.CreateCompController=i},8982:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CreateUpdateCompControllerProto=void 0,t.CreateUpdateCompControllerProto=class{constructor(e,t,s){this.inputText=e,this.inputColor=t,this.btn=s}toogleCtlsDisabled(e){this.inputText.disabled=e,this.inputColor.disabled=e,this.btn.disabled=e}}},2477:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateCompController=void 0;const r=s(5094),a=s(4690),n=s(379),o=s(6911),i=s(8982);class c extends i.CreateUpdateCompControllerProto{constructor(e){super(e.inputText,e.inputColor,e.btn),this.rxs=new Set,this.chooseCarListener=async e=>{console.log(e),e.msg instanceof o.DBusMsgCarActionSelectedMsg&&(this.choosedCar=r.OBJ_PROCESSOR.deepClone(e.msg.car),this.notifyCb=e.msg.notifyChanges,this.inputColor.value=e.msg.car.color,this.inputText.value=e.msg.car.name,this.toogleCtlsDisabled(!1))},this.setupBtnUpdate()}autoConnect(e){const t=e.getNewRX(this.chooseCarListener,"listen car choosing");e.plugRX(a.DBusTopics.CAR_ACTION,t)}setupBtnUpdate(){this.toogleCtlsDisabled(!0),this.btn.addEventListener("click",(()=>{this.toogleCtlsDisabled(!0),this.choosedCar&&(this.choosedCar.color=this.inputColor.value,this.choosedCar.name=this.inputText.value,n.REST_CLIENT_GARAGE.updateCar(this.choosedCar).then((e=>{this.notifyCb&&this.notifyCb(e)})).finally((()=>{this.toogleCtlsDisabled(!1)})))}))}}t.UpdateCompController=c},3525:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateUpdateComponent=void 0;const a=s(1168),n=s(5856),o=s(4312),i=s(2477),c=r(s(2022)),d=r(s(6725));class l extends a.BaseComp{constructor(e,t){super("div"),this.hubName=n.DBUS_HUB_NAMES.CREATE_UPDATE,this.textInput=document.createElement("input"),this.colorInput=document.createElement("input"),this.btn=document.createElement("button"),this._rootElement.classList.add(c.default.root),this.textInput.type="text",this.textInput.classList.add(c.default["text-input"]),this.colorInput.type="color",this.colorInput.classList.add(c.default["color-input"]),this.btn.textContent=t,this.btn.classList.add(d.default.btn),this._rootElement.append(this.textInput,this.colorInput,this.btn);const s={inputText:this.textInput,inputColor:this.colorInput,btn:this.btn};switch(e){case"UPDATE":this.controller=new i.UpdateCompController(s),this.btn.classList.add(d.default["btn-13"]);break;case"CREATE":default:this.controller=new o.CreateCompController(s),this.btn.classList.add(d.default["btn-13"])}}connect(e){this.controller.autoConnect(e)}}t.CreateUpdateComponent=l},3173:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgGenerateCarsMsg=void 0;const r=s(4690),a=s(7469);class n extends a.DBusMsg{constructor(e,t,s){super(r.DBusTopics.GENERATE,t,s),this.status=e,this.rxIds=t,this.prefResponseRxIds=s}}t.DBusMsgGenerateCarsMsg=n},44:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MainControlsComp=void 0;const a=s(1168),n=s(3525),o=s(5856),i=s(9362),c=s(745),d=s(3102),l=r(s(7715)),h=r(s(6725)),u=s(379),_=s(9653),p=s(4590),E=s(928),g=s(2994),m=s(3018),R=s(4690),C=s(3173),b=s(1011);class f extends a.BaseComp{constructor(){super("div"),this.hubName=o.DBUS_HUB_NAMES.MAIN_CONTROLS,this.txs=new Set,this.createComponent=new n.CreateUpdateComponent("CREATE","create"),this.updateComponent=new n.CreateUpdateComponent("UPDATE","update"),this.btnRace=document.createElement("button"),this.btnReset=document.createElement("button"),this.btnGenerate=document.createElement("button"),this.popup=new b.PopupStandaloneModalProgressComp,this.generateClickListener=async()=>{this.btnGenerate.disabled=!0;const e=new C.DBusMsgGenerateCarsMsg("start"),t=[];this.txs.forEach((s=>{const r=s.transmit({msg:e,prepMode:c.DBusTXPrepModes.freeze,waitMode:c.DBusTXWaitModes.allSetled});t.push(r)})),await Promise.allSettled(t),this.popup.reset().setText("please wait while the entries are generated").show(),await this.generate(100,void 0,this.genCb),this.popup.reset().hide();const s=new C.DBusMsgGenerateCarsMsg("end");this.txs.forEach((e=>{e.transmit({msg:s,prepMode:c.DBusTXPrepModes.freeze,waitMode:c.DBusTXWaitModes.nowait})})),this.btnGenerate.disabled=!1},this.genCb=e=>{this.popup.setProgress(e)},this.raceClickListener=async()=>{if(0===this.txs.size)return;this.btnRace.disabled=!0,this.btnGenerate.disabled=!0;const e=new i.DBusMsgRaceRequestMsg;this.txs.forEach((t=>{t.transmit({msg:e,prepMode:c.DBusTXPrepModes.freeze,waitMode:c.DBusTXWaitModes.allSetled})}))},this.resetClickListener=async()=>{if(0===this.txs.size)return;const e=new d.DBusMsgGarageResetReqMsg;this.txs.forEach((t=>{t.transmit({msg:e,prepMode:c.DBusTXPrepModes.freeze,waitMode:c.DBusTXWaitModes.allSetled})}))},this.genRandomCarName=()=>{const e=p.getRandomInt(_.CAR_MODEL_LIST_KEYS.length-1),t=_.CAR_MODEL_LIST_KEYS[e],s=_.CAR_MODEL_LIST[t];return`${t} ${s[p.getRandomInt(s.length-1)]}`},this.rxFuncForRaceMsgs=async e=>{if(e.msg instanceof m.DBusMsgGarageRaceStatusMsg){const{status:t}=e.msg;switch(t){case"READY_TO_GO":this.btnRace.disabled=!1,this.btnReset.disabled=!0,this.btnGenerate.disabled=!1;break;case"IN_PROCESS":this.btnRace.disabled=!0,this.btnReset.disabled=!1,this.btnGenerate.disabled=!0;break;case"NEED_RESET":this.btnRace.disabled=!0,this.btnReset.disabled=!1,this.btnGenerate.disabled=!1}}return g.DBUS_COMMON_RESPONSES.VOID},this._rootElement.classList.add(l.default["main-controls"]);const e=this.renderBtns();this.btnRace.addEventListener("click",this.raceClickListener),this.btnReset.addEventListener("click",this.resetClickListener),this.btnGenerate.addEventListener("click",this.generateClickListener),this.btnReset.disabled=!0,this.btnRace.disabled=!0,this._rootElement.append(this.createComponent.rootElement,this.updateComponent.rootElement,e)}renderBtns(){const e=document.createElement("span");e.textContent="race",this.btnRace.append(e),this.btnRace.classList.add(h.default.btn,h.default["btn-15"]),this.btnReset.textContent="reset",this.btnReset.classList.add(h.default.btn,h.default["btn-9"]),this.btnGenerate.textContent="generate cards",this.btnGenerate.classList.add(h.default.btn,h.default["btn-1"]);const t=document.createElement("div");return t.classList.add(l.default["btn-block"]),t.append(this.btnRace,this.btnReset,this.btnGenerate),t}async generate(e,t,s){let r=t||e;const a={name:this.genRandomCarName(),color:p.genRandomHexColor()},n={id:(await u.REST_CLIENT_GARAGE.createCar(a)).id,wins:p.getRandomArbitraryInt(1,3),time:Number.parseFloat((p.getRandomArbitraryInt(40,50)/3).toFixed(2))};return await E.REST_CLIENT_WINNERS.createWinner(n),r--,s&&s(100*(1-r/e)),!(r>0)||this.generate(e,r,s)}connect(e){e.attachSubHub(this.createComponent,"cu_create"),e.attachSubHub(this.updateComponent,"cu_delete");const t=e.getNewRX(this.rxFuncForRaceMsgs,"toggle btns in main-ctls-block");e.plugRX(R.DBusTopics.GARAGE,t);const s=e.getNewTX("start race | broadcast generate");this.txs.add(s)}}t.MainControlsComp=f},1598:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TrackComp=void 0;const a=s(1168),n=r(s(2096));class o extends a.BaseComp{constructor(){super("div"),this.topBlock=document.createElement("div"),this.illuminateSelf=e=>{console.log(e),e?this._rootElement.classList.add(n.default.track_illuminated):this._rootElement.classList.remove(n.default.track_illuminated)},this._rootElement.classList.add(n.default.track),this._rootElement.append(),this.topBlock.classList.add(n.default["track__controls-block"])}placeCar(e){this._rootElement.hasChildNodes()&&this._rootElement.childNodes.forEach((e=>e.remove())),this.topBlock.append(e.spanCarName),this._rootElement.append(this.topBlock,e.rootElement)}}t.TrackComp=o},4977:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HeaderComponent=void 0;const a=s(1168),n=s(2994),o=s(5856),i=s(4690),c=s(7950),d=r(s(3544)),l=s(9546);class h extends a.BaseComp{constructor(e=o.DBUS_HUB_NAMES.HEADER){super("header"),this.hubName=e,this.buses=[],this.illuminateNavItem=async e=>{const{msg:t}=e;return t instanceof c.DBusMsgRouteIsChangedMsg&&this.anchors.forEach((e=>{e.getAttribute("href")===t.newRoute?e.classList.add(d.default["header-nav__anchor_active"]):e.classList.remove(d.default["header-nav__anchor_active"])})),n.DBUS_COMMON_RESPONSES.VOID},this.rootElement.classList.add(d.default.header),this.logo=document.createElement("h1"),this.logo.classList.add(d.default.header__logo);const t=document.createElement("span");t.textContent="async";const s=document.createElement("span");s.textContent="race",this.logo.append(t,s),this.rootElement.append(this.logo),this.navContainer=document.createElement("nav"),this.navContainer.classList.add(d.default["header-nav"]),this.rootElement.append(this.navContainer);const r=document.createElement("ul");r.classList.add(d.default["header-nav__list"]),this.navContainer.append(r);const a={li:d.default["header-nav__item"],a:d.default["header-nav__anchor"],svg:d.default["header-nav__svg"],span:d.default["header-nav__span"]},i=[new l.NavItem("garage","#garage",a),new l.NavItem("winners","#winners",a)];this.anchors=i.map((e=>e.anchor)),r.append(...i.map((e=>e.rootElement)))}connect(e){const t=e.getNewRX(this.illuminateNavItem,"illuminate nav items");e.plugRX(i.DBusTopics.ROUTING,t)}}t.HeaderComponent=h},9546:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NavItem=void 0;const r=s(1168);class a extends r.BaseComp{constructor(e,t,s,r){super("li"),s?.li&&this._rootElement.classList.add(s.li),this._anchor=document.createElement("a"),this._anchor.setAttribute("href",t),s?.a&&this._anchor.classList.add(s.a),r&&(this.iconImage=document.createElement("img"),this.iconImage.src=r,s?.svg&&this.iconImage.classList.add(s.svg),this._anchor.append(this.iconImage)),this.span=document.createElement("span"),this.span.textContent=e,s?.span&&this.span.classList.add(s.span),this._anchor.append(this.span),this.rootElement.append(this._anchor)}get anchor(){return this._anchor}}t.NavItem=a},8655:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WinnerRowComp=void 0;const r=s(1168),a=s(8990);class n extends r.BaseComp{constructor(e,t,s){super("tr"),this.indexElem=document.createElement("td"),this.idElem=document.createElement("td"),this.carPreviewBox=document.createElement("td"),this.nameElem=document.createElement("td"),this.winsElem=document.createElement("td"),this.bestTimeElem=document.createElement("td"),this.indexElem.textContent=e.toString(),this.idElem.textContent=t.id.toString(),this.carPreview=a.CarComp.genPreview(s),this.carPreviewBox.append(this.carPreview),this.nameElem.textContent=s.name,this.winsElem.textContent=t.wins.toString(),this.bestTimeElem.textContent=t.time.toString(),this._rootElement.append(this.indexElem,this.idElem,this.carPreviewBox,this.nameElem,this.winsElem,this.bestTimeElem)}getCarPreview(){return this.carPreview}}t.WinnerRowComp=n},3287:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WinnersComp=void 0;const a=s(1168),n=s(379),o=s(928),i=s(5474),c=s(8655),d=s(7612),l=r(s(9052)),h=r(s(6725));class u extends a.BaseComp{constructor(){super("section"),this.table=document.createElement("table"),this.tableBody=document.createElement("tbody"),this.tableHead=document.createElement("thead"),this.thId=document.createElement("th"),this.thCar=document.createElement("th"),this.thName=document.createElement("th"),this.thWins=document.createElement("th"),this.thBestTime=document.createElement("th"),this.currOrder="DESC",this.currSort="wins",this.entriesPerPage=10,this.pagerCallback=async e=>{try{return await this.refillTable(void 0,void 0,e),!0}catch{return!1}},this.tableHeadClickListener=async e=>{let t;switch(e.target){case this.thId:t=i.REST_CLIENT_WINNERS_SORT_OPTIONS.id;break;case this.thWins:t=i.REST_CLIENT_WINNERS_SORT_OPTIONS.wins;break;case this.thBestTime:t=i.REST_CLIENT_WINNERS_SORT_OPTIONS.time}if(t){const s=e.target;this.currOrder=s.classList.contains(l.default["table__sorted-elem_desc"])?"ASC":"DESC",this.currSort=t,await this.refillTable(),this.refreshTableHeader(s)}},this.refreshTableHeader=e=>{this.currSortedElem&&this.currSortedElem.classList.remove(l.default["table__sorted-elem"]),e.classList.add(l.default["table__sorted-elem"]),this.currSortedElem=e,"ASC"===this.currOrder?(e.classList.remove(l.default["table__sorted-elem_desc"]),e.classList.add(l.default["table__sorted-elem_asc"])):(e.classList.remove(l.default["table__sorted-elem_asc"]),e.classList.add(l.default["table__sorted-elem_desc"]))},this._rootElement.classList.add(l.default.winners),this._rootElement.style.setProperty("background-image","url('./assets/imgs/backgrounds/winners/anime-girl-cyberpunk-ride-4k-lx-2880x1800.jpg')");const e=document.createElement("div");e.classList.add(l.default.pager),this.pager=new d.Pager(this.entriesPerPage,this.pagerCallback);const t=this.pager.getBtnPrevPage(),s=this.pager.getBtnNextPage();t.classList.add(h.default.btn,h.default["btn-6"],l.default["pager-btn"]),s.classList.add(h.default.btn),s.classList.add(h.default.btn,h.default["btn-6"],l.default["pager-btn"]),e.append(t,s);const r=this.pager.getPagerSpan();r.classList.add(l.default["pager-span"]),this.table.append(this.tableHead,this.tableBody,e,r),this.table.classList.add(l.default.table),this._rootElement.append(this.table),this.renderHeader(),this.refillTable().then((()=>this.refreshTableHeader(this.thBestTime)))}notify(){this.refillTable(this.currSort,this.currOrder).then((()=>this.refreshTableHeader(this.currSortedElem||this.thBestTime)))}renderHeader(){const e=document.createElement("tr"),t=document.createElement("th");t.textContent="№",this.thId.textContent="ID",this.thId.classList.add(l.default["table__can-be-sorted"]),this.thCar.textContent="CAR",this.thName.textContent="NAME",this.thWins.textContent="WINS",this.thWins.classList.add(l.default["table__can-be-sorted"]),this.thBestTime.textContent="BEST TIME",this.thBestTime.classList.add(l.default["table__can-be-sorted"]),e.append(t,this.thId,this.thCar,this.thName,this.thWins,this.thBestTime),this.tableHead.append(e),this.tableHead.addEventListener("click",this.tableHeadClickListener)}async refillTable(e,t,s){return new Promise(((r,a)=>{const i=s?"next"===s?this.pager.getCurrPageNumber()+1:this.pager.getCurrPageNumber()-1:this.pager.getCurrPageNumber(),d=t||this.currOrder,h=e||this.currSort;o.REST_CLIENT_WINNERS.getWinners(i,10,h,d).then((async e=>{if(this.pager.setEntriesCount(Number.parseInt(e.limit,10)),0===e.cars.length)return void a();const t=new Array(e.cars.length),s=[],o=10*(i-1);for(e.cars.forEach(((e,r)=>{const a=n.REST_CLIENT_GARAGE.getCar(e.id).then((s=>{const a=r+o+1,n=new c.WinnerRowComp(a,e,s);t[r]=n}));s.push(a)})),await Promise.allSettled(s);this.tableBody.firstChild;)this.tableBody.firstChild.remove();this.tableBody.append(...t.map((e=>(e.getCarPreview().classList.add(l.default["table__car-preview-box"]),e.rootElement)))),r(!0)}))}))}}t.WinnersComp=u,u.TEXT_CONTENT_ENG={}},9653:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CAR_MODEL_LIST_KEYS=t.CAR_MODEL_LIST=void 0;const r=s(5094),a=r.OBJ_PROCESSOR.deepFreeze({Lamborghini:["Murciélago","350 GT","400 GT","Sián FKP 37","Essenza SCV12","Urus","Centenario","Huracán","Veneno","Sesto Elementо","Aventador","Reventón","Gallardo","Diablo","LM002","Jalpa","Silhouette","Countach","Urraco","Jarama","Islero","Espada","Miura"],"Aston Martin":["Project 003","Valkyrie","DBS","Vanquish Zagato","Vanquish","Virage/Virage Volante","V12 Zagato","One-77","V8 Coupe/V8 Volante","V8 Zagato"],Ferrari:["Roma","Portfolio","488 GTB","California T","360 Spider","355 F1 Berlinetta","F355 GTS","456 GT","Testarossa","SF1000"],Koenigsegg:["Jesko Absolut","Jesko","Agera Final","Agera XS","Agera X","Agera S","Regera","Agera RS","One:1","CCGT"]});t.CAR_MODEL_LIST=a;const n=r.OBJ_PROCESSOR.deepFreeze(Object.keys(a));t.CAR_MODEL_LIST_KEYS=n},1168:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseComp=void 0,t.BaseComp=class{constructor(e="div"){this._rootElement=document.createElement(e)}get rootElement(){return this._rootElement}}},8743:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PopupStandaloneModalComp=void 0;const a=s(3213),n=r(s(3588));class o extends a.PopupStandaloneComp{constructor(){super(),this._rootElement.classList.add(n.default["popup-modal"]);const e=document.createElement("div");e.classList.add(n.default["popup-bg"]),this._rootElement.append(e),this.body.classList.add(n.default["popup-body"]),e.append(this.body),this.header.classList.add(n.default["popup-body-header"]),this.text.classList.add(n.default["popup-body-text"])}}t.PopupStandaloneModalComp=o},1011:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PopupStandaloneModalProgressComp=void 0;const a=s(8743),n=r(s(9715)),o=r(s(6725));class i extends a.PopupStandaloneModalComp{constructor(){super(),this.barContainer=document.createElement("div"),this.bar=document.createElement("div"),this.barContainer.classList.add(n.default.container),this.bar.classList.add(n.default.bar),this.barContainer.append(this.bar),this.text.classList.add(n.default.text,o.default["glitched-text"]),this.body.classList.add(n.default.body),this.body.append(this.barContainer)}setText(e){return this.text.textContent=e,this.text.dataset.textContent=e,this}reset(){return this.bar.style.removeProperty("--progress"),this.text.textContent="",this.text.dataset.textContent="",this}show(){return document.body.append(this._rootElement),this}hide(){return this._rootElement.remove(),this}setProgress(e){return this.bar.style.setProperty("--progress",`${e}%`),this}}t.PopupStandaloneModalProgressComp=i},3213:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PopupStandaloneComp=void 0;const r=s(1168);class a extends r.BaseComp{constructor(){super("div"),this.body=document.createElement("div"),this.header=document.createElement("h3"),this.text=document.createElement("p"),this.body.append(this.header,this.text),this._rootElement.append(this.body)}}t.PopupStandaloneComp=a},9007:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hexToRgb=void 0,t.hexToRgb=function(e){let t;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return t=e.split(""),4===t.length&&(t=[t[1],t[1],t[2],t[2],t[3],t[3]]),{r:Number.parseInt(e.slice(1,3),16),g:Number.parseInt(e.slice(3,5),16),b:Number.parseInt(e.slice(5,7),16)};throw new Error("Bad Hex")}},4590:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.genRandomHexColor=t.getRandomArbitraryInt=t.getRandomInt=t.genUniqId=void 0,t.genUniqId=function(){const e=new Uint8Array(4);return window.crypto.getRandomValues(e).join("")},t.getRandomInt=function(e){return Math.floor(Math.random()*e)},t.getRandomArbitraryInt=function(e,t){return Math.floor(Math.random()*(t-e)+e)},t.genRandomHexColor=function e(){const t=`#${Math.floor(16777215*Math.random()).toString(16)}`;return 7===t.length?t:e()}},9630:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNotifiable=void 0,t.isNotifiable=function(e){return"notify"in e&&"function"==typeof e.notify}},5094:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OBJ_PROCESSOR=void 0;const s=new class{constructor(){this.deepFreeze=e=>{if("object"==typeof e&&null!==e){const t=e;return Object.keys(t).forEach((e=>{"object"!=typeof t[e]||Object.isFrozen(t[e])||this.deepFreeze(t[e])})),Object.freeze(e)}throw new Error("not object")},this.deepClone=e=>{if(Array.isArray(e)){const t=[];return e.forEach((e=>{t.push(e)})),t.map((e=>this.deepClone(e)))}if("object"==typeof e&&null!==e){if(e instanceof HTMLElement)return e.cloneNode(!0);if(e instanceof Blob)return e.slice();const t={...e};return Object.keys(t).forEach((e=>{t[e]=this.deepClone(t[e])})),Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}return e}}};t.OBJ_PROCESSOR=s,s.deepFreeze(s)},7172:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBus=void 0;const r=s(4590),a=s(5094),n=s(7247),o=s(492),i=s(8927),c=s(2606),d=s(745),l=s(4441),h=s(7656),u=s(5856);t.DBus=class{constructor(){return this.network=new Map,this.idCounter={txs:0,rxs:0},this.createdRXs=new Set,this.createdTXs=new Set,this.attachedHubs=new Map,this.occupiedNames=new Set,this.callRXFunc=(e,t)=>{switch(e.headers.prepMode){case d.DBusTXPrepModes.clone:return(()=>{const s=a.OBJ_PROCESSOR.deepClone(e);return t.func(s)})();case d.DBusTXPrepModes.freeze:return(()=>{const s=a.OBJ_PROCESSOR.deepFreeze(e);return t.func(s)})();default:throw new Error(n.DBUS_ERRORS.UNEXPECTED_PREP_MODE)}},this.busId=r.genUniqId(),Object.freeze(this)}attachHub(e,t){return this.createInterfaceForHub(e,void 0,t)}createInterfaceForHub(e,t,s){if(this.attachedHubs.has(e))throw new Error(n.DBUS_ERRORS.HUB_IS_ALREADY_ATTACHED);if(!(e.hubName in u.DBUS_HUB_NAMES))throw new Error(n.DBUS_ERRORS.HUB_NAME_NOT_AUTHORIZED);let r=t?`${t}_${e.hubName}`:e.hubName;if(s&&(r+=`_${s}`),this.occupiedNames.has(r))throw new Error(n.DBUS_ERRORS.HUB_NAME_IS_OCCUPIED);const o=new h.DBusInterface((e=>this.getNewTX(r,e)),((e,t)=>this.genNewRX(e,t)),((e,t)=>this.plugRX(e,t)),((e,t)=>this.unplugRX(e,t)),((e,t)=>this.createInterfaceForHub(e,r,t)));return this.occupiedNames.add(r),this.attachedHubs.set(e,o),a.OBJ_PROCESSOR.deepFreeze(o),e.connect(o)}getNewTX(e,t){const s=r.genUniqId(),n=this.idCounter.txs++,o=new i.DBusTX(n,s,this.busId,(async r=>{const a=new l.DBusTXDataHeaders(e,s,n,r.waitMode,r.prepMode,t),o=new c.DBusTXData(a,r.msg);return await this.transmit(o)})),d=a.OBJ_PROCESSOR.deepFreeze(o);return this.createdTXs.add(d),d}genNewRX(e,t){const s=r.genUniqId(),n=this.idCounter.rxs++,i=new o.DBusRX(n,s,this.busId,e,t),c=a.OBJ_PROCESSOR.deepFreeze(i);return this.createdRXs.add(c),c}plugRX(e,t){if(!this.createdRXs.has(t))throw new Error(n.DBUS_ERRORS.XENO_RX);this.network.has(e)||this.network.set(e,new Set),this.network.get(e)?.add(t)}unplugRX(e,t){this.network.get(e)?.delete(t)}async transmit(e){if(!this.network.has(e.msg.topic))throw new Error(n.DBUS_ERRORS.TOPIC_IS_NOT_EXIST);const t=this.network.get(e.msg.topic);if(void 0===t||0===t.size)throw new Error(n.DBUS_ERRORS.TOPIC_HAS_NO_RXS);let s,r=[];if(e.msg.prefResponseRxIds){if(t.forEach((t=>{e.msg.prefResponseRxIds?.includes(t.id)&&r.push(t)})),0===r.length)throw new Error(n.DBUS_ERRORS.PREF_RXS_ARE_NOT_EXIST)}else r=[...t];switch(e.headers.waitMode){case d.DBusTXWaitModes.all:s=await Promise.all(r.map((t=>this.callRXFunc(e,t))));break;case d.DBusTXWaitModes.allSetled:s=await Promise.allSettled(r.map((t=>this.callRXFunc(e,t))));break;case d.DBusTXWaitModes.manual:s=r;break;case d.DBusTXWaitModes.nowait:default:r.map((t=>this.callRXFunc(e,t))),s=!0}return s}}},2994:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBUS_COMMON_RESPONSES=void 0;const r=s(5094).OBJ_PROCESSOR.deepFreeze({VOID:"VOID",BAD_REQUEST:"BAD_REQUEST"});t.DBUS_COMMON_RESPONSES=r},7247:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBUS_ERRORS=void 0;const r=s(5094).OBJ_PROCESSOR.deepFreeze({HUB_NAME_IS_OCCUPIED:"HUB_NAME_IS_OCCUPIED",HUB_IS_ALREADY_ATTACHED:"HUB_IS_ALREADY_ATTACHED",HUB_NAME_NOT_AUTHORIZED:"HUB_NAME_NOT_AUTHORIZED",XENO_RX:"XENO_RX",TOPIC_IS_NOT_EXIST:"TOPIC_IS_NOT_EXIST",TOPIC_HAS_NO_RXS:"TOPIC_HAS_NO_RXS",PREF_RXS_ARE_NOT_EXIST:"PREF_RXS_ARE_NOT_EXIST",UNEXPECTED_PREP_MODE:"UNEXPECTED_PREP_MODE"});t.DBUS_ERRORS=r},5856:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBUS_HUB_NAMES=void 0;const r=s(5094),a=new class{constructor(){this.APP="APP",this.ROUTER="ROUTER",this.GARAGE="GARAGE",this.HEADER="HEADER",this.MAIN_CONTROLS="MAIN_CONTROLS",this.CREATE_UPDATE="CREATE_UPDATE",this.GARAGE_CONTROLLER="GARAGE_CONTROLLER"}},n=r.OBJ_PROCESSOR.deepFreeze(a);t.DBUS_HUB_NAMES=n},7656:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusInterface=t.isDBusHub=void 0;const r=s(5856);t.isDBusHub=function(e){const t=e;return"connect"in t&&"hubName"in t&&"string"==typeof t.hubName&&t.hubName in r.DBUS_HUB_NAMES},t.DBusInterface=class{constructor(e,t,s,r,a){this.arrowedGetNewTX=e,this.arrowedGetNewRX=t,this.arrowedPlugRX=s,this.arrowedUnplugRX=r,this.attachSubHub=a,this.RXs=new Set,this.TXs=new Set,this.RXsPlugMap=new Map}getNewRX(e,t){const s=this.arrowedGetNewRX(e,t);return this.RXs.add(s),s}getNewTX(e){const t=this.arrowedGetNewTX(e);return this.TXs.add(t),t}plugRX(e,t){this.RXsPlugMap.has(e)||this.RXsPlugMap.set(e,new Set),this.RXsPlugMap.get(e)?.add(t),this.arrowedPlugRX(e,t)}unplugRX(e,t){this.RXsPlugMap.get(e)?.delete(t),this.arrowedUnplugRX(e,t)}}},492:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusRX=void 0,t.DBusRX=class{constructor(e,t,s,r,a){this.regNumber=e,this.id=t,this.busId=s,this.func=r,this.desc=a}}},4690:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.DBusTopics=void 0,(s=t.DBusTopics||(t.DBusTopics={}))[s.ROUTING=0]="ROUTING",s[s.CAR_ACTION=1]="CAR_ACTION",s[s.GARAGE=2]="GARAGE",s[s.REST_CLIENT_REQUESTS=3]="REST_CLIENT_REQUESTS",s[s.GENERATE=4]="GENERATE"},4441:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusTXDataHeaders=void 0,t.DBusTXDataHeaders=class{constructor(e,t,s,r,a,n){this.hubName=e,this.txId=t,this.txRegNumber=s,this.waitMode=r,this.prepMode=a,this.txDesc=n}}},2606:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusTXData=void 0,t.DBusTXData=class{constructor(e,t){this.headers=e,this.msg=t}}},745:(e,t)=>{var s,r;Object.defineProperty(t,"__esModule",{value:!0}),t.DBusTXPrepModes=t.DBusTXWaitModes=void 0,(r=t.DBusTXWaitModes||(t.DBusTXWaitModes={}))[r.nowait=0]="nowait",r[r.all=1]="all",r[r.allSetled=2]="allSetled",r[r.manual=3]="manual",(s=t.DBusTXPrepModes||(t.DBusTXPrepModes={}))[s.clone=0]="clone",s[s.freeze=1]="freeze"},8927:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusTX=void 0,t.DBusTX=class{constructor(e,t,s,r){this.regNumber=e,this.id=t,this.busId=s,this.transmit=r}}},7469:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsg=void 0,t.DBusMsg=class{constructor(e,t,s){this.topic=e,this.rxIds=t,this.prefResponseRxIds=s}}},7612:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Pager=void 0,t.Pager=class{constructor(e,t,s=document.createElement("button"),r=document.createElement("button")){this.entriesPerPage=e,this.listCallback=t,this.btnPrevPage=s,this.btnNextPage=r,this.firstPageNumber=1,this.currPageNumber=this.firstPageNumber,this.lastPageNumber=0,this.pagerSpan=document.createElement("span"),this.entriesCount=0,this.callbackIsCalled=!1;const a=document.createElement("span");a.textContent="Next page",this.btnNextPage.append(a);const n=document.createElement("span");n.textContent="Prev page",this.btnPrevPage.append(n),this.btnNextPage.addEventListener("click",(()=>this.callCallback("next"))),this.btnPrevPage.addEventListener("click",(()=>this.callCallback("prev")))}toogleLock(e){this.toggleBtnsDisabled(e)}getEntriesPerPage(){return this.entriesPerPage}setLastPageNumber(e){this.lastPageNumber=e,this.callbackIsCalled||this.toggleBtnsDisabled(!1)}setEntriesCount(e){this.entriesCount=e,this.lastPageNumber=Math.ceil(this.entriesCount/this.entriesPerPage),this.pagerSpan.textContent=`Entries: ${e}, Pages: ${this.lastPageNumber}`,this.callbackIsCalled||this.toggleBtnsDisabled(!1)}getCurrPageNumber(){return this.currPageNumber}getBtnPrevPage(){return this.btnPrevPage}getBtnNextPage(){return this.btnNextPage}getPagerSpan(){return this.pagerSpan}tryChangePage(e){return this.callCallback(e)}async callCallback(e){if(this.callbackIsCalled=!0,this.toggleBtnsDisabled(!0),await this.listCallback(e))switch(e){case"next":this.currPageNumber++;break;case"prev":this.currPageNumber--}this.toggleBtnsDisabled(!1),this.callbackIsCalled=!1}toggleBtnsDisabled(e){if(!0===e)return this.btnPrevPage.disabled=!0,void(this.btnNextPage.disabled=!0);this.currPageNumber>this.firstPageNumber?this.btnPrevPage.disabled=!1:this.btnPrevPage.disabled=!0,this.currPageNumber<this.lastPageNumber?this.btnNextPage.disabled=!1:this.btnNextPage.disabled=!0}}},2623:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgRoutingMsg=void 0;const r=s(4690),a=s(7469);class n extends a.DBusMsg{constructor(e,t){super(r.DBusTopics.ROUTING,e,t)}}t.DBusMsgRoutingMsg=n},7950:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgRouteIsChangedMsg=void 0;const r=s(2623);class a extends r.DBusMsgRoutingMsg{constructor(e,t,s){super(t,s),this.newRoute=e}}t.DBusMsgRouteIsChangedMsg=a},1209:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleRouterAgent=void 0,t.SimpleRouterAgent=class{constructor(e,t,s,r,a){this.type=e,this.path=t,this.callback=s,this.getStateCallback=r,this.setStateCallback=a}}},5207:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleRouter=void 0;const r=s(5094),a=s(5856),n=s(745),o=s(7950);t.SimpleRouter=class{constructor(e){switch(this.hubName=a.DBUS_HUB_NAMES.ROUTER,this.agents=new Set,this.txs=new Set,this.restrictions=new Set,e.mode){case"#":break;case"?":throw new Error(`${e.mode} is not supported yet!`);default:throw new Error(`${e.mode} is not supported!`)}this.options=r.OBJ_PROCESSOR.deepFreeze(e),window.addEventListener("popstate",(async()=>{if(window.location.href!==this.currRoute)if(this.restrictions.size>0){const e=window.location.href;this.currRoute?window.location.href=this.currRoute:this.options.defaultRoot&&(window.location.href=`${window.location.host}/${this.options.defaultRoot}`);const t=[...this.restrictions.values()],s=t.map((e=>e())),r=await Promise.all(s);let a=!1;if(Array.isArray(r))for(let e=0;e<r.length;e++){if("boolean"!=typeof r[e])throw new Error("restrict func returned not boolean value!");if(r[e]){const s=t[e];s&&this.restrictions.delete(s)}else a=!0}a||(window.location.href=e)}else this.activateWantedAgents()}))}activateWantedAgents(){this.currRoute=window.location.href;let e=0;const t=[];if(!this.options.onlyDBus&&"#"===this.options.mode){const s=[...this.agents];for(let t=0;t<this.agents.size;t++)if(s[t]?.path===window.location.hash){try{s[t]?.callback()}catch(e){e.push(e)}e++;break}0===e&&(this.defaultAgent&&this.options.defaultRoot===window.location.hash?this.defaultAgent.callback():t.push(new Error("Agent is not finded")))}return this.txs.size>0&&this.txs.forEach((e=>{const t=new o.DBusMsgRouteIsChangedMsg(window.location.hash);e.transmit({msg:t,waitMode:n.DBusTXWaitModes.nowait,prepMode:n.DBusTXPrepModes.freeze})})),t.length>0?t:e>0}addRouterAgent(e){this.agents.add(e)}removeRouterAgent(e){this.agents.delete(e)}flushRouterAgents(){this.agents.clear()}connect(e){const t=e.getNewTX("broadcasting route changes");this.txs.add(t)}}},9461:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REST_CLIENT_ENGINE=void 0;const r=s(5094),a=s(3231),n=new class{constructor(e){this.baseUrl=e,this.resUrl="/engine",this.fullUrl=e+this.resUrl}toggleEngine(e,t){return new Promise(((s,r)=>{const n=`${this.fullUrl}?id=${e}&status=${t}`;fetch(n,{method:"GET"}).then((e=>{if(200===e.status)return e.json();throw new Error(a.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>s(e))).catch((e=>{e.message in a.REST_CLIENT_ERROR?r(e):r(new Error(a.REST_CLIENT_ERROR.UNKNOWN_ERROR))}))}))}enterDriveMode(e){return new Promise(((t,s)=>{const r=`${this.fullUrl}?id=${e}&status=drive`;fetch(r,{method:"GET"}).then((e=>{switch(e.status){case 200:t(!0);break;case 400:case 404:case 429:case 500:default:s(new Error(`${e.status}`))}}))}))}}("http://127.0.0.1:3000"),o=r.OBJ_PROCESSOR.deepFreeze(n);t.REST_CLIENT_ENGINE=o},9496:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgRESTReqGarageCreateCarMsg=void 0;const r=s(8381),a=s(3748);class n extends r.DBusMsgRESTReqMsg{constructor(e,t,s){super(a.REST_CLIENT_NAMES.GARAGE,t,s),this.unregCar=e,this.rxIds=t,this.prefResponseRxIds=s}}t.DBusMsgRESTReqGarageCreateCarMsg=n},4282:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgRESTReqGarageDeleteCarMsg=void 0;const r=s(8381),a=s(3748);class n extends r.DBusMsgRESTReqMsg{constructor(e,t,s){super(a.REST_CLIENT_NAMES.GARAGE,t,s),this.id=e,this.rxIds=t,this.prefResponseRxIds=s}}t.DBusMsgRESTReqGarageDeleteCarMsg=n},379:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REST_CLIENT_GARAGE=void 0;const r=s(5094),a=s(2994),n=s(4690),o=s(8381),i=s(3231),c=s(3748),d=s(9496),l=s(4282),h=new class{constructor(e){this.baseUrl=e,this.clientName=c.REST_CLIENT_NAMES.GARAGE,this.txs=new Set,this.resUrl="/garage",this.requestRXFunc=async e=>{if(e.msg instanceof o.DBusMsgRESTReqMsg&&e.msg.destClient===this.clientName){if(e.msg instanceof d.DBusMsgRESTReqGarageCreateCarMsg)return this.createCar(e.msg.unregCar);if(e.msg instanceof l.DBusMsgRESTReqGarageDeleteCarMsg)return this.deleteCar(e.msg.id)}return a.DBUS_COMMON_RESPONSES.VOID},this.fullUrl=e+this.resUrl}autoConnect(e){const t=e.getNewRX(this.requestRXFunc,"listen requests to db");e.plugRX(n.DBusTopics.REST_CLIENT_REQUESTS,t)}getCars(e,t){return new Promise(((s,r)=>{const a=t||"",n=`${this.fullUrl}?_page=${e}&_limit=${a}`;let o="";fetch(n,{method:"GET"}).then((e=>{if(200===e.status)return o=e.headers.get("X-Total-Count"),e.json();throw new Error(i.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>s({limit:o,cars:e}))).catch((e=>{e.message in i.REST_CLIENT_ERROR?r(e):r(new Error(i.REST_CLIENT_ERROR.UNKNOWN_ERROR))}))}))}getCar(e){return new Promise(((t,s)=>{const r=`${this.fullUrl}/${e}`;fetch(r,{method:"GET"}).then((e=>{if(200===e.status)return e.json();if(404===e.status)throw new Error(i.REST_CLIENT_ERROR.NOT_FOUND);throw new Error(i.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>t(e))).catch((e=>{e.message in i.REST_CLIENT_ERROR?s(e):s(new Error(i.REST_CLIENT_ERROR.UNKNOWN_ERROR))}))}))}createCar(e){return new Promise(((t,s)=>{fetch(this.fullUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(201===e.status)return e.json();throw new Error(i.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>t(e))).catch((e=>{e.message in i.REST_CLIENT_ERROR?s(e):s(new Error(i.REST_CLIENT_ERROR.UNKNOWN_ERROR))}))}))}deleteCar(e){return new Promise(((t,s)=>{const r=`${this.fullUrl}/${e}`;fetch(r,{method:"DELETE"}).then((e=>{if(200===e.status&&t(!0),404===e.status)throw new Error(i.REST_CLIENT_ERROR.NOT_FOUND);throw new Error(i.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).catch((e=>{e.message in i.REST_CLIENT_ERROR?s(e):s(new Error(i.REST_CLIENT_ERROR.UNKNOWN_ERROR))}))}))}updateCar(e){return new Promise(((t,s)=>{const r=`${this.fullUrl}/${e.id}`,a=e;fetch(r,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>{if(200===e.status)return e.json();if(404===e.status)throw new Error(i.REST_CLIENT_ERROR.NOT_FOUND);throw new Error(i.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>t(e))).catch((e=>{e.message in i.REST_CLIENT_ERROR?s(e):s(new Error(i.REST_CLIENT_ERROR.UNKNOWN_ERROR))}))}))}}("http://127.0.0.1:3000");h.autoConnect=e=>{};const u=r.OBJ_PROCESSOR.deepFreeze(h);t.REST_CLIENT_GARAGE=u},5474:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REST_CLIENT_WINNERS_SORT_OPTIONS=void 0;const r=s(5094),a=new class{constructor(){this.id="id",this.wins="wins",this.time="time"}},n=r.OBJ_PROCESSOR.deepFreeze(a);t.REST_CLIENT_WINNERS_SORT_OPTIONS=n},928:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REST_CLIENT_WINNERS=void 0;const r=s(5094),a=s(3231),n=new class{constructor(e){this.baseUrl=e,this.resUrl="/winners",this.fullUrl=e+this.resUrl}getWinners(e=0,t,s,r){return new Promise(((n,o)=>{const i=t||"";let c=`${this.fullUrl}?_page=${e}&_limit=${i}`;s&&(c+=`&_sort=${s}`),r&&(c+=`&_order=${r}`);let d="";fetch(c,{method:"GET"}).then((e=>{if(200===e.status)return d=e.headers.get("X-Total-Count"),e.json();throw new Error(a.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>n({limit:d,cars:e}))).catch((e=>{e.message in a.REST_CLIENT_ERROR?o(e):o(new Error(a.REST_CLIENT_ERROR.UNKNOWN_ERROR))}))}))}getWinner(e){return new Promise(((t,s)=>{const r=`${this.fullUrl}/${e}`;fetch(r,{method:"GET"}).then((e=>{if(200===e.status)return e.json();if(404===e.status)throw new Error(a.REST_CLIENT_ERROR.NOT_FOUND);throw new Error(a.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>t(e))).catch((e=>{e.message in a.REST_CLIENT_ERROR?s(e):s(new Error(a.REST_CLIENT_ERROR.UNKNOWN_ERROR))}))}))}createWinner(e){return new Promise(((t,s)=>{fetch(this.fullUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(201===e.status)return e.json();throw new Error(a.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>t(e))).catch((e=>{e.message in a.REST_CLIENT_ERROR?s(e):s(new Error(a.REST_CLIENT_ERROR.UNKNOWN_ERROR))}))}))}deleteWinner(e){return new Promise(((t,s)=>{const r=`${this.fullUrl}/${e}`;fetch(r,{method:"DELETE"}).then((e=>{if(200===e.status&&t(!0),404===e.status)throw new Error(a.REST_CLIENT_ERROR.NOT_FOUND);throw new Error(a.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).catch((e=>{e.message in a.REST_CLIENT_ERROR?s(e):s(new Error(a.REST_CLIENT_ERROR.UNKNOWN_ERROR))}))}))}updateWinner(e){return new Promise(((t,s)=>{const r=`${this.fullUrl}/${e.id}`,n=e;fetch(r,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>{if(200===e.status)return e.json();if(404===e.status)throw new Error(a.REST_CLIENT_ERROR.NOT_FOUND);throw new Error(a.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>t(e))).catch((e=>{e.message in a.REST_CLIENT_ERROR?s(e):s(new Error(a.REST_CLIENT_ERROR.UNKNOWN_ERROR))}))}))}}("http://127.0.0.1:3000"),o=r.OBJ_PROCESSOR.deepFreeze(n);t.REST_CLIENT_WINNERS=o},8381:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgRESTReqMsg=void 0;const r=s(4690),a=s(7469);class n extends a.DBusMsg{constructor(e,t,s){super(r.DBusTopics.REST_CLIENT_REQUESTS,t,s),this.destClient=e,this.rxIds=t,this.prefResponseRxIds=s}}t.DBusMsgRESTReqMsg=n},3231:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REST_CLIENT_ERROR=void 0;const r=s(5094).OBJ_PROCESSOR.deepFreeze({UNEXPECTED_RESULT:"UNEXPECTED_RESULT",UNKNOWN_ERROR:"UNKNOWN_ERROR",NOT_FOUND:"NOT_FOUND"});t.REST_CLIENT_ERROR=r},3748:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REST_CLIENT_NAMES=void 0;const r=s(5094),a=new class{constructor(){this.GARAGE="GARAGE",this.WINNERS="WINNERS"}};t.REST_CLIENT_NAMES=a,r.OBJ_PROCESSOR.deepFreeze(a)}},t={};function s(r){var a=t[r];if(void 0!==a)return a.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,s),n.exports}s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{const e=s(6752);window.addEventListener("load",(()=>{const t=document.createElement("div");document.body.append(t),new e.App(t)}))})()})();
//# sourceMappingURL=main.fc1f9c110a74d08da8bd.js.map