(()=>{"use strict";var e={3916:(e,t,s)=>{s.r(t),s.d(t,{default:()=>a});const a={garage:"_21SC4SGf5mTamWfNdNRR",garage__bg:"_2VnbeeG4HKnZfSWUedizHh","garage__track-container":"_1rsPT6UvHnbHI-FUFvPaSe","hue-rotate":"_3MSD3skhU7RLqKdx6pBax7","garage__track-container_finish":"_1khEfVJzcbQlBMhoHPdhzY","garage__winner-popup":"_17InT8lGlAlk8k1JRcrTCM","garage-bg":"-BA3r_cxZwAYkgGQVVZeo","garage-bg__video":"_3byu86MCf3s6B7JQuetNAw","garage-bg__car-ctl-btn":"_3upDU-ngLjybmFg4wiVvfl","garage-bg__car-ctl-block-number":"_3dT19pzigDW1UKuPVLEguq","garage-bg__car-ctl-block":"_2e0Ox8Joh0jw60ztR_rVt5","garage-bg__cars-ctls-block":"wMVLCRcoluFnZleBHWXlm","garage-bg__self-ctls-block":"_2VQVmkB2amN4PG9XCyFye9","garage-bg__pager":"_2avafWgl8XDS2KLJswKq0H","garage-bg__pager-span":"_3ktlpozBQghco3VMHLJBo1","garage-bg__pager-btn":"_2QdjLaEnj3Balh89eZAya4","synthwave-background":"_2pUKJme_w_0KTS_JoVNV5b","synthwave-background_race-mode":"n1z9UH35nfilmkK2lmQvV",race:"_375ItX4gjZY-ZT7KrEfBgG","move-grid":"_1MqERRNbzZtvdd9iE43L04"}},6010:(e,t,s)=>{s.r(t),s.d(t,{default:()=>a});const a={"car-div":"_3pRKwGaRv59JcJqlApAnkk","car-div__canvas":"rH6_OMXna8-zeemMHF11D","car-div__wheel":"_3WNDl-LGGtViqzAfLLX4CB","car-div__wheel_forward":"_3Rdh32fs7fi-95LcabV_Ed","car-div__wheel_backward":"_3xptMXOOFn6YcMVYMigRMa","car-div__explosion":"_3w8-mlW0m2zLABohqiDQ3e","car-div_rollForward":"_3xWmq3Q2UpNiq2nICrGAIN","car-div-anim":"_381V-1xCMVwSdGT0FxnQiO","tire-anim":"_2Qs9DAZPIqZivw_0ON2Vot"}},2022:(e,t,s)=>{s.r(t),s.d(t,{default:()=>a});const a={root:"_2uo9WXSTJyDD3jBlT_quev","text-input":"_2YNdYEaErpy02Ske_bZONx","color-input":"_3Ye7rbfoBnq4HZn4H-yDB8"}},7715:(e,t,s)=>{s.r(t),s.d(t,{default:()=>a});const a={"main-controls":"_2b_svto1O0DGSO3_579_Xj","btn-block":"_262VSHreYXfZUHLGeCJEvZ"}},2096:(e,t,s)=>{s.r(t),s.d(t,{default:()=>a});const a={track:"_2hDrLwwwZMiv2NrI-XZZqJ",track_illuminated:"_3zXlLAoKpXJ_jlpauHLjHR","track__controls-block":"_3pqcODoHFqX9rxmLKBnhD4"}},3544:(e,t,s)=>{s.r(t),s.d(t,{default:()=>a});const a={header:"_3TTTWNe5aoHesw4iV0YUGU",header__logo:"_2idUQTZia_1M_0xkhMkXf8","header-nav":"_7vejZGT8OzUejTiWyGs1P","header-nav__item":"_1NYwlHRXmh2YGu63soBsjx","header-nav__anchor":"_2n39qEg5Iz5Tym2Z0Jrjz9","header-nav__anchor_active":"_2bRvd3RlExbbSpyXLuxSdS","header-nav__svg":"_2FCXcgNK7Jgl9f3ZK-O56I","header-nav__span":"_1NVrpdaSQLvqho4VNqQqit","header-nav__list":"_1vy8OijKt-Cy7SGXyM4ek9","header-nav__list_disabled":"_25SilQm6mkAlbl-WpajKBY"}},9052:(e,t,s)=>{s.r(t),s.d(t,{default:()=>a});const a={winners:"HVDfoBgyIQ4teF5EKFzcD",table:"_3mJKnd573Tt4WspNl7gf1J","table__car-preview-box":"_86kcZK8UgXIsvYD-wpDED","table__can-be-sorted":"_3Xa74hpyx3g6XUuZ9fB9Cm","table__sorted-elem":"rfPuVNCW0Sd4nzQGO8-R8","table__sorted-elem_asc":"N6296gY2c5AFEX4KjE4I4","table__sorted-elem_desc":"_37bMOUs2OF28ZqMubJCPnM",pager:"_2q-noyJbwIpKOMhl7AWlq5","pager-span":"_1O8erRuDz9RWa3C9tqnUm-","pager-btn":"_3OktYstRgXgDE6zlpOM6LA"}},3588:(e,t,s)=>{s.r(t),s.d(t,{default:()=>a});const a={"popup-modal":"_3KlZOyoPt2P4FT1Ofdi1oz","popup-bg":"_1QGzfQYEHvrYonFptRzkG6","popup-body":"_3zDyJwNy615xogiYvCl4vt","popup-body-header":"_2DglTs5KJlA1QJriRI6bVZ","popup-body-text":"_2oMxBL_Jv1KW3bHu3sVdaA","popup-body__btn-close":"HV1Imp7Np5N8O5nUXwQsS"}},9715:(e,t,s)=>{s.r(t),s.d(t,{default:()=>a});const a={container:"_1KBIW4BNGKHwQtRcKc6JIF","hue-rotate":"_1t6lrd-wEBCB6ei-o9kDmk",bar:"_2DWg3PnmWwM25SBd7sLJQK",body:"_24wm1l_qZHsMTx2Oy-enF4",text:"_1UFV3thankQQ1R2Ly1Zle2"}},6725:(e,t,s)=>{s.r(t),s.d(t,{default:()=>a});const a={app:"_2ljk-3_Qk7EjDct5a15qZP","main-component":"_394erWdWCWrQmkYlaBZ1L5",btn:"_3cliA46UjEIGfEKGRnJzCZ","btn-1":"_7q7sGuJSjnM-fV8DfMtl5","btn-4":"KE9Fso9VtLV8xX_x8IAiF","btn-6":"_35BryCkuNmCUsRxmBw_Y1","btn-9":"_9jiLaDmXVuzxrmO3P-9mb","btn-13":"_1872fOtVBrHuR0iXYtVhRT","btn-15":"TNTO3dtfSfS40M6g8U274","glitched-text":"xB_2phBrodgB6jPUYYf8V","glitch-animation-1":"_2N8U2GaQpCAdpuVv32CY9B","glitch-animation-2":"_1g8DjVAkpXimf-Ld9-LLk8"}},6752:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.App=void 0;const r=s(1209),n=s(5207),i=s(7172),o=s(7950),c=s(4690),d=s(2994),l=s(4977),h=a(s(6725)),u=s(8785),p=s(7656),_=s(5856),E=s(3287),g=s(3231),m=s(9630),R=s(2841),C=s(379);t.App=class{constructor(e){this.rootElement=e,this.hubName=_.DBUS_HUB_NAMES.APP,this.loadedMainComponents={},this.defaultRouterAgent=new r.SimpleRouterAgent("hash","",(()=>this.loadMainComponent("default"))),this.router=new n.SimpleRouter({mode:"#",defaultRoot:"",defaultAgent:this.defaultRouterAgent}),this.mainlineDBus=new i.DBus,this.watchRouterMsgs=async e=>{const{msg:t}=e;return t instanceof o.DBusMsgRouteIsChangedMsg&&this.loadMainComponent(t.newRoute),d.DBUS_COMMON_RESPONSES.VOID},window.addEventListener("error",(e=>console.log(e))),window.addEventListener("unhandledrejection",(e=>{e.preventDefault(),e.promise.catch((e=>{if(e.message in g.REST_CLIENT_ERROR&&e.message===g.REST_CLIENT_ERROR.CONNECTION_REFUSED){const e=new R.PopupStandaloneModal404Comp;e.setText("No connection, check if server is started!").show();const t=async()=>{try{await C.REST_CLIENT_GARAGE.getCars(),e.hide(),this.router.activateWantedAgents()}catch{await new Promise((e=>setTimeout(e,1e3))),t()}};t()}}))})),this.rootElement.classList.add(h.default.app);const t=new l.HeaderComponent(_.DBUS_HUB_NAMES.HEADER);this.rootElement.append(t.rootElement),this.mainlineDBus.attachHub(t),this.mainlineDBus.attachHub(this),this.mainlineDBus.attachHub(this.router),this.router.activateWantedAgents()}connect(e){const t=e.getNewRX(this.watchRouterMsgs);e.plugRX(c.DBusTopics.ROUTING,t)}loadMainComponent(e){if(!(e in this.loadedMainComponents))switch(e){case"#garage":this.loadedMainComponents[`${e}`]=new u.GarageComp;break;case"#winners":this.loadedMainComponents[`${e}`]=new E.WinnersComp;break;default:window.location.hash="#garage"}const t=this.loadedMainComponents[`${e}`];if(t){if(this.currMainComponent&&this.currMainComponent.rootElement.remove(),this.currMainComponent=t,t.rootElement.classList.add(h.default["main-component"]),this.rootElement.append(t.rootElement),p.isDBusHub(this.currMainComponent))try{this.mainlineDBus.attachHub(this.currMainComponent)}catch{}m.isNotifiable(this.currMainComponent)&&(console.log("notify"),this.currMainComponent.notify(null))}}}},1069:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.CarActions=void 0,(s=t.CarActions||(t.CarActions={}))[s.CREATED=0]="CREATED",s[s.SELECTED=1]="SELECTED",s[s.REMOVED=2]="REMOVED",s[s.UPDATED=3]="UPDATED"},2223:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgCarActionMsg=void 0;const a=s(4690),r=s(7469);class n extends r.DBusMsg{constructor(e,t,s){super(a.DBusTopics.CAR_ACTION,t,s),this.action=e,this.rxIds=t,this.prefResponseRxIds=s}}t.DBusMsgCarActionMsg=n},9237:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgCarActionCreatedMsg=void 0;const a=s(1069),r=s(2223);class n extends r.DBusMsgCarActionMsg{constructor(e,t,s){super(a.CarActions.CREATED,t,s),this.car=e,this.rxIds=t,this.prefResponseRxIds=s}}t.DBusMsgCarActionCreatedMsg=n},8577:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgCarActionRemovedMsg=void 0;const a=s(1069),r=s(2223);class n extends r.DBusMsgCarActionMsg{constructor(e,t,s,r){super(a.CarActions.REMOVED,s,r),this.car=e,this.nullifiedContract=t,this.rxIds=s,this.prefResponseRxIds=r}}t.DBusMsgCarActionRemovedMsg=n},6911:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgCarActionSelectedMsg=void 0;const a=s(1069),r=s(2223);class n extends r.DBusMsgCarActionMsg{constructor(e,t,s,r){super(a.CarActions.SELECTED,s,r),this.car=e,this.notifyChanges=t,this.rxIds=s,this.prefResponseRxIds=r}}t.DBusMsgCarActionSelectedMsg=n},9565:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgGarageRaceMsg=void 0;const a=s(4690),r=s(7469);class n extends r.DBusMsg{constructor(e,t){super(a.DBusTopics.GARAGE,e,t),this.rxIds=e,this.prefResponseRxIds=t}}t.DBusMsgGarageRaceMsg=n},8381:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgRaceRequestMsg=void 0;const a=s(9565);class r extends a.DBusMsgGarageRaceMsg{constructor(e,t){super(e,t),this.rxIds=e,this.prefResponseRxIds=t}}t.DBusMsgRaceRequestMsg=r},3018:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgGarageRaceStatusMsg=void 0;const a=s(9565);class r extends a.DBusMsgGarageRaceMsg{constructor(e,t,s){super(t,s),this.status=e,this.rxIds=t,this.prefResponseRxIds=s}}t.DBusMsgGarageRaceStatusMsg=r},7977:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgGarageResetMsg=void 0;const a=s(4690),r=s(7469);class n extends r.DBusMsg{constructor(e,t){super(a.DBusTopics.GARAGE,e,t),this.rxIds=e,this.prefResponseRxIds=t}}t.DBusMsgGarageResetMsg=n},3102:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgGarageResetReqMsg=void 0;const a=s(7977);class r extends a.DBusMsgGarageResetMsg{constructor(e,t){super(e,t),this.rxIds=e,this.prefResponseRxIds=t}}t.DBusMsgGarageResetReqMsg=r},4768:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GarageComponentControllerAkaDirector=void 0;const r=s(2994),n=s(5856),i=s(4690),o=s(379),c=s(8577),d=s(8856),l=s(8990),h=s(1598),u=s(9237),p=s(8381),_=s(3102),E=a(s(3916)),g=a(s(6725)),m=s(7612),R=s(3173);class C{constructor(e,t){this.tracksContainer=e,this.carCtlsBlock=t,this.hubName=n.DBUS_HUB_NAMES.GARAGE_CONTROLLER,this.txs=new Set,this.entriesPerPage=7,this.pagerContainer=document.createElement("div"),this.carImgRatio=3.78,this.scaleFactor=.95,this.pagerCallback=async e=>{try{return await this.reloadData(e),!0}catch{return!1}},this.generatorRXFunc=async e=>(e.msg instanceof R.DBusMsgGenerateCarsMsg&&"end"===e.msg.status&&this.garageManagersTeam.getContracts().size<7&&this.reloadData("no"),r.DBUS_COMMON_RESPONSES.VOID),this.racingRXFunc=async e=>e.msg instanceof p.DBusMsgRaceRequestMsg?(this.pager.toogleLock(!0),await this.performRace(),this.pager.toogleLock(!1),!0):e.msg instanceof _.DBusMsgGarageResetReqMsg?this.resetState():r.DBUS_COMMON_RESPONSES.VOID,this.carActionsRXFunc=async e=>{if(e.msg instanceof c.DBusMsgCarActionRemovedMsg||e.msg instanceof u.DBusMsgCarActionCreatedMsg)try{this.reloadData("no")}catch{this.pager.tryChangePage("prev")}return r.DBUS_COMMON_RESPONSES.VOID},this.createCarCtlBlock=(e,t)=>{const s=[e.btnSelect,e.btnStart,e.btnReset,e.btnRm];e.btnStart.classList.add(g.default["btn-15"]),e.btnSelect.classList.add(g.default["btn-13"]),e.btnReset.classList.add(g.default["btn-9"]),e.btnRm.classList.add(g.default["btn-4"]),s.forEach((e=>{e.classList.add(g.default.btn,E.default["garage-bg__car-ctl-btn"])}));const a=document.createElement("span");a.classList.add(E.default["garage-bg__car-ctl-block-number"]),a.textContent=t.toString();const r=document.createElement("div");return r.classList.add(E.default["garage-bg__car-ctl-block"]),r.append(a,...s),r},this.connectCtlAndTrack=(e,t)=>{e.addEventListener("mouseover",(()=>t.illuminateSelf(!0)),!0),e.addEventListener("mouseout",(()=>t.illuminateSelf(!1)),!0)},this.garageManagersTeam=new d.GarageManagersTeam(e,t),this.pagerContainer.classList.add(E.default["garage-bg__pager"]),this.pager=new m.Pager(this.entriesPerPage,this.pagerCallback);const s=this.pager.getBtnNextPage(),a=this.pager.getBtnPrevPage();s.classList.add(g.default.btn,g.default["btn-6"],E.default["garage-bg__pager-btn"]),a.classList.add(g.default.btn,g.default["btn-6"],E.default["garage-bg__pager-btn"]);const i=this.pager.getPagerSpan();i.classList.add(E.default["garage-bg__pager-span"]),this.pagerContainer.append(a,s,i)}async startWorking(){try{return await this.reloadData("no"),window.addEventListener("resize",(()=>this.redraw())),!0}catch{return!1}}async connect(e){this.txs.add(e.getNewTX("send requests to REST Garage client")),this.garageManagersTeam.autoConnect(e);const t=e.getNewRX(this.carActionsRXFunc,"monitor cars removes");e.plugRX(i.DBusTopics.CAR_ACTION,t);const s=e.getNewRX(this.racingRXFunc,"handle race requsets");e.plugRX(i.DBusTopics.GARAGE,s);const a=e.getNewRX(this.generatorRXFunc);e.plugRX(i.DBusTopics.GENERATE,a)}async resetState(){return await this.garageManagersTeam.resetState()}async performRace(){await this.garageManagersTeam.performRace()}reloadData(e){return new Promise(((t,s)=>{const a=e?"next"===e?this.pager.getCurrPageNumber()+1:"prev"===e?this.pager.getCurrPageNumber()-1:"no"===e?this.pager.getCurrPageNumber():1:1;o.REST_CLIENT_GARAGE.getCars(a,this.pager.getEntriesPerPage()).then((async a=>{const{limit:r,cars:n}=a;if(this.pager.setEntriesCount(Number.parseInt(r,10)),0===n.length&&"no"!==e)return void s();await this.garageManagersTeam.nullifyContracts();const i=[];n.forEach(((e,t)=>{const s=new h.TrackComp,a=new l.CarComp(e,t+1);s.placeCar(a),i.push({track:s,car:a})})),this.garageManagersTeam.addContracts(...i),this.garageManagersTeam.resetState(),this.redraw(),t(!0)}))}))}redraw(){this.clearDOM(),[...this.garageManagersTeam.getContracts()].map((e=>e.track));const e=this.calcGeometry();this.setStylesForTracks(e),this.drawTracks(),this.drawCarsCtls()}clearDOM(){for(;this.tracksContainer.firstChild;)this.tracksContainer.firstChild.remove();for(;this.carCtlsBlock.firstChild;)this.carCtlsBlock.firstChild.remove()}calcGeometry(){const e=window.getComputedStyle(this.tracksContainer),t=Number.parseFloat(e.height)-Number.parseFloat(e.paddingBottom)-Number.parseFloat(e.paddingTop),s=.2*window.innerWidth/this.carImgRatio,a=[];let r=0;const n=[...this.garageManagersTeam.getContracts()];n.forEach(((e,t)=>{const n=this.scaleFactor**t,i=s*n;r+=i,a.push(i)}));const i=r-t,o=a.sort(((e,t)=>e-t)),c=i>0?i/this.garageManagersTeam.getContracts().size-2:0,d=[],l=(n.length-1)/2;n.forEach(((e,t)=>{const s=c*-(t-l)+C.DISPLACEMENT_FIX;d.push(s)}));const h=o[0]*this.carImgRatio,u=20*window.innerWidth/1920;return{trackHeights:o,displacements:d,paddingBase:h,paddingAddShift:u}}setStylesForTracks(e){const t=[...this.garageManagersTeam.getContracts()];t.forEach(((s,a)=>{s.track.rootElement.style.setProperty("height",`${e.trackHeights[a]}px`),s.track.rootElement.style.setProperty("top",`${e.displacements[a]}px`),s.track.rootElement.style.setProperty("z-index",`${a+1}`),s.track.rootElement.style.setProperty("--padding-w",e.trackHeights[e.trackHeights.length-1-a]*this.carImgRatio-e.paddingBase+e.paddingAddShift*(t.length-1-a)+"px")}))}drawTracks(){this.tracksContainer.append(this.pagerContainer,...[...this.garageManagersTeam.getContracts()].map((e=>e.track.rootElement)))}drawCarsCtls(){const e=[...this.garageManagersTeam.getContracts()].map(((e,t)=>{const s=this.createCarCtlBlock(e.car,t+1);return this.connectCtlAndTrack(s,e.track),s}));this.carCtlsBlock.append(...e)}}t.GarageComponentControllerAkaDirector=C,C.DISPLACEMENT_FIX=-20},1294:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GarageDriver=t.GarageDriverCommands=void 0;const a=s(1011),r=s(4590),n=s(9461);var i;(i=t.GarageDriverCommands||(t.GarageDriverCommands={}))[i.START_DRIVING=0]="START_DRIVING",i[i.STOP_DRIVING=1]="STOP_DRIVING";class o{isFree(){return!this.contract}putBehindTheWheel(e){if(this.contract)throw new Error("ALREADY IN CAR");this.contract=e}async getOutOfTheCar(){this.contract=void 0}async performDrivingProtocol(e){return new Promise(((t,s)=>{e&&this.contract?.car.disableCtls();const a=r.genUniqId();this.currDriveId=a,this.ignitionPromise=this.TurnOnTheIgnition().then((r=>{a!==this.currDriveId&&s(new Error("interrupted"));const n=this.drive(r,a,e);t({driveParams:r,drivePromise:n})})).catch((e=>{a!==this.currDriveId?s(new Error("interrupted")):s(e)}))}))}async TurnOnTheIgnition(){if(!this.contract)throw new Error("NOT_BEHIND_THE_WHEEL");return this.drivePromise&&await this.drivePromise,await n.REST_CLIENT_ENGINE.toggleEngine(this.contract.car.currCar.id,"started")}async returnToStart(){if(this.currDriveId=void 0,this.contract)if(this.ignitionPromise&&await this.ignitionPromise,this.drivePromise){await this.stopCar(!0,!1),await this.contract.car.rollBack(this.drivePromise);const e=document.createElement("div");e.style.setProperty("height","100%"),e.style.setProperty("width","40%"),e.style.setProperty("position","absolute"),e.style.setProperty("right","0px"),e.style.setProperty("top","100%"),e.style.setProperty("transform","translate(-40%, -120%)"),this.contract.track.rootElement.append(e);const t=new a.PopupStandaloneModalProgressComp;t.setText("I can't let the engine start again until\n          the server finishes its business, read the notes, please.").show(e);const s=this.updateProgress(t);await this.contract.car.playAwaitingAnim(this.drivePromise),s&&clearTimeout(s),t.hide(),e.remove()}else await this.stopCar(!1,!1),await this.contract.car.rollBack();return!0}updateProgress(e){const t=setInterval((()=>{if(this.lastTimeInMs&&this.lastStart){const t=(Date.now()-this.lastStart)/this.lastTimeInMs*100;console.log(t),e.setProgress(t)}else clearInterval(t)}),500);return t}async drive(e,t,s){return new Promise(((a,r)=>{if(this.contract){const{contract:i}=this,c=o.calculateDriveTime(e);this.lastStart=Date.now(),this.lastTimeInMs=1e3*c;const d=Date.now();this.drivePromise=n.REST_CLIENT_ENGINE.enterDriveMode(i.car.currCar.id).then((e=>{i!==this.contract||t!==this.currDriveId?r(new Error("interrupted")):e?(a(c),console.log("stop car finish"),this.stopCar(!0,!0,!1,s)):(console.log("stop car broken"),this.stopCar(!0,!1,!0,s),a(!1)),console.log("time from start: "+(Date.now()-d))})),i.car.rollForward(c,!s).catch((()=>{a(!1)}))}else r(new Error("No car"))}))}async stopCar(e=!1,t=!0,s=!1,a){if(this.contract){if(!s&&!e){const e=await n.REST_CLIENT_ENGINE.toggleEngine(this.contract.car.currCar.id,"stopped");console.log("stopped by server",e)}return await this.contract.car.stop(t,s,a),!0}throw new Error("No car")}static calculateDriveTime(e){return e.distance/1e3/e.velocity}}t.GarageDriver=o},8856:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GarageManagersTeam=void 0;const r=s(745),n=s(6911),i=s(379),o=s(8577),c=s(1294),d=s(4590),l=a(s(3916)),h=s(928),u=s(3231),p=s(3018),_=s(3662),E=s(6670);t.GarageManagersTeam=class{constructor(e,t){this.tracksContainer=e,this.carCtlsBlock=t,this.txs=new Set,this.contracts=new Set,this.freeDrivers=new Set,this.busyDrivers=new Map,this.winnerPopup=new E.GaragePopupWinner,this.carCtlsClickListener=e=>{if(e.target instanceof HTMLElement){const t=e.target;let s;t instanceof HTMLButtonElement?s=t:t.parentElement instanceof HTMLButtonElement&&(s=t.parentElement),s&&!0!==s.disabled&&this.contracts.forEach((e=>{if(!this.currRaceId){if(s!==e.car.btnSelect)return s===e.car.btnRm?(e.car.btnRm.disabled=!0,void this.handleRemoving(e)):s===e.car.btnStart?(e.car.btnStart.disabled=!0,void this.startDriving(e)):void(s===e.car.btnReset&&(e.car.btnReset.disabled=!0,this.handleRestoreState(e)));this.handleSelection(e)}}))}},this.handleWinner=async(e,t,s)=>{s.isFinishVisible=!0,this.tracksContainer.classList.add(l.default["garage__track-container_finish"]);const a=window.getComputedStyle(this.tracksContainer,"::after"),r=_.getTransitionDuration(a,"right");if(r){const e=Number.parseFloat(r);e>0&&await new Promise((t=>setTimeout(t,1e3*e)))}this.tracksContainer.classList.remove(l.default["synthwave-background_race-mode"]),s.isRoadMoves=!1;const n=e.car.currCar;this.winnerPopup.setData(n,t.toFixed(2),e.car.index?.toString()),this.tracksContainer.append(this.winnerPopup.rootElement),h.REST_CLIENT_WINNERS.getWinner(n.id).then((e=>{const s={id:e.id,wins:e.wins+1,time:t<e.time?Number.parseFloat(t.toFixed(2)):e.time};h.REST_CLIENT_WINNERS.updateWinner(s)})).catch((e=>{if(e.message===u.REST_CLIENT_ERROR.NOT_FOUND){const e={id:n.id,wins:1,time:Number.parseFloat(t.toFixed(2))};h.REST_CLIENT_WINNERS.createWinner(e)}}))},this.carCtlsBlock.addEventListener("click",this.carCtlsClickListener),this.winnerPopup.rootElement.classList.add(l.default["garage__winner-popup"])}autoConnect(e){const t=e.getNewTX("garage serviceman");this.txs.add(t)}getContracts(){return this.contracts}async nullifyContracts(e){e?(this.tryFreeDrivers(...e),e.forEach((e=>{this.contracts.delete(e)}))):(this.tryFreeDrivers(...this.contracts),this.contracts.clear())}addContracts(...e){e.forEach((e=>this.contracts.add(e)))}async resetState(e){e||(this.currRaceId=void 0),this.winnerPopup.rootElement.remove(),this.tracksContainer.classList.remove(l.default["synthwave-background_race-mode"]),await this.rollbackCars(),e||this.broadcastRaceStatus("READY_TO_GO")}async handleRestoreState(e){const t=this.busyDrivers.get(e);t&&await t.returnToStart()}async startDriving(e,t){let s=this.busyDrivers.get(e);return s||(s=[...this.freeDrivers].find((e=>e.isFree())),s?this.freeDrivers.delete(s):s=new c.GarageDriver,this.busyDrivers.set(e,s),s.putBehindTheWheel(e)),s.performDrivingProtocol(t)}handleRemoving(e){i.REST_CLIENT_GARAGE.deleteCar(e.car.currCar.id).then((async()=>{await h.REST_CLIENT_WINNERS.deleteWinner(e.car.currCar.id).catch((()=>{})),this.tryFreeDrivers(e),this.contracts.delete(e);const t=new o.DBusMsgCarActionRemovedMsg(e.car.currCar,e);this.txs.forEach((e=>{e.transmit({msg:t,prepMode:r.DBusTXPrepModes.freeze,waitMode:r.DBusTXWaitModes.nowait})}))}))}handleSelection(e){const t=new n.DBusMsgCarActionSelectedMsg(e.car.currCar,this.genSelectCallback(e));this.txs.forEach((e=>{e.transmit({msg:t,prepMode:r.DBusTXPrepModes.freeze,waitMode:r.DBusTXWaitModes.nowait})}))}async rollbackCars(){this.tracksContainer.classList.remove(l.default["garage__track-container_finish"]),this.tracksContainer.style.setProperty("--translate-x","0px");const e=[];this.busyDrivers.forEach((t=>{e.push(t.returnToStart())})),await Promise.all(e)}async performRace(){const e=d.genUniqId();if(this.currRaceId=e,await this.resetState(!0),e!==this.currRaceId)return;const t={raceId:e,arrivedByOrder:[],notArrived:[],participantsCount:this.contracts.size,flags:{roadElem:this.tracksContainer,isFinishVisible:!1},stratedCount:0};this.broadcastRaceStatus("IN_PROCESS"),await this.processRace(t).catch((t=>{if(e===this.currRaceId)throw t})).finally((()=>{this.tracksContainer.classList.remove(l.default["synthwave-background_race-mode"])})),e===this.currRaceId&&this.broadcastRaceStatus("NEED_RESET")}broadcastRaceStatus(e){const t=new p.DBusMsgGarageRaceStatusMsg(e);this.txs.forEach((e=>{e.transmit({msg:t,prepMode:r.DBusTXPrepModes.freeze,waitMode:r.DBusTXWaitModes.nowait})}))}processRace(e){return new Promise((t=>{this.contracts.forEach((s=>{this.startDriving(s,e.flags).then((a=>{if(e.raceId===this.currRaceId){if(e.stratedCount===e.participantsCount-1?(this.tracksContainer.classList.add(l.default["synthwave-background_race-mode"]),e.flags.isRoadMoves=!0):e.stratedCount++,a instanceof Error)throw a;a.drivePromise.then((t=>this.handleDriveResult(e,s,t))).catch((e=>{"interrupted"===e.message&&t(!1)})).finally((()=>{console.log(e),e.arrivedByOrder.length+e.notArrived.length===e.participantsCount&&(console.log(e),t(e))}))}else t(!1)}))}))}))}handleDriveResult(e,t,s){e.raceId===this.currRaceId&&(!1!==s?(0===e.arrivedByOrder.length&&this.handleWinner(t,s,e.flags),e.arrivedByOrder.push(t)):e.notArrived.push(t))}tryFreeDrivers(...e){e.forEach((e=>{const t=this.busyDrivers.get(e);t&&t.getOutOfTheCar().then((()=>{this.busyDrivers.delete(e),this.freeDrivers.add(t)}))}))}genSelectCallback(e){return t=>{this.contracts.has(e)&&e.car.updateData(t)}}}},8785:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GarageComp=void 0;const r=s(1168),n=s(5856),i=s(4768),o=s(44),c=a(s(3916)),d=s(1011);class l extends r.BaseComp{constructor(){super("section"),this.hubName=n.DBUS_HUB_NAMES.GARAGE,this.isControllerWorking=!1,this.mainControlsComp=new o.MainControlsComp,this.carsCtlsBlock=document.createElement("div"),this.bgVideo=document.createElement("video"),this.popup=new d.PopupStandaloneModalProgressComp,this.bgVideoProgressListener=()=>{if(this.bgVideo.buffered.length>0){const e=this.bgVideo.buffered.end(0)/this.bgVideo.duration*100;this.popup.setProgress(e)}},this.bgVideoCanPlayListener=async()=>{this.bgVideo.removeEventListener("canplaythrough",this.bgVideoCanPlayListener),this.bgVideo.removeEventListener("progress",this.bgVideoProgressListener),this.isControllerWorking=await this.controller.startWorking(),this.popup.setProgress(100).reset().hide()},this.notify=async()=>{try{this.bgVideo.play()}catch{}this.isControllerWorking||(this.popup.setProgress(1).setText("Loading...").show(),this.isControllerWorking=await this.controller.startWorking(),this.popup.reset().hide())},this.popup.setText("Loading...").setProgress(1).show(),this._rootElement.classList.add(c.default.garage);const e=document.createElement("div");e.classList.add(c.default["garage__track-container"],c.default["synthwave-background"]);const t=document.createElement("div");t.classList.add(c.default["garage-bg__self-ctls-block"]),t.append(this.mainControlsComp.rootElement);const s=document.createElement("div");s.classList.add(c.default.garage__bg,c.default["garage-bg"]),this.bgVideo.classList.add(c.default["garage-bg__video"]),this.bgVideo.controls=!1,this.bgVideo.loop=!0,this.bgVideo.defaultMuted=!0,this.bgVideo.muted=!0,this.bgVideo.autoplay=!0,this.bgVideo.addEventListener("progress",this.bgVideoProgressListener),this.bgVideo.addEventListener("canplaythrough",this.bgVideoCanPlayListener),this.bgVideo.src="./assets/videos/bg/cyberpunk2077-garage.mp4",s.append(this.bgVideo,t),this.controller=new i.GarageComponentControllerAkaDirector(e,this.carsCtlsBlock),this.carsCtlsBlock.classList.add(c.default["garage-bg__cars-ctls-block"]),this._rootElement.append(s,e,this.carsCtlsBlock)}connect(e){e.attachSubHub(this.controller),e.attachSubHub(this.mainControlsComp)}}t.GarageComp=l},8990:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CarComp=void 0;const r=s(1168),n=s(9007),i=s(5094),o=a(s(6010)),c=a(s(3916));class d extends r.BaseComp{constructor(e,t){super("div"),this._currCar=e,this.index=t,this.canvas=document.createElement("canvas"),this.tireBack=document.createElement("img"),this.btnSelect$=document.createElement("button"),this.btnRm$=document.createElement("button"),this._spanCarName=document.createElement("span"),this.btnStart$=document.createElement("button"),this.btnReset$=document.createElement("button"),this.isReseted=!0,this.movingClassName=c.default["synthwave-background_race-mode"],this.clearAnimFromElem=e=>{const t=e;"commitStyles"in t&&"function"==typeof t.commitStyles&&t.commitStyles()},this._rootElement.classList.add(o.default["car-div"]),this.canvas.classList.add(o.default["car-div__canvas"]),this._rootElement.append(this.canvas);const s=document.createElement("span"),a=document.createElement("span"),r=document.createElement("span"),n=document.createElement("span");s.textContent="select",a.textContent="remove",r.textContent="start!",n.textContent="reset",this.btnSelect$.append(s),this.btnRm$.append(a),this.btnReset$.append(n),this.btnStart$.append(r),this.btnReset$.disabled=!0,d.drawCar(this.canvas,this._currCar.color),this._spanCarName.textContent=`${t}: ${e.name}`,d.drawWheels(this._rootElement),this.observer=new MutationObserver((e=>{e.forEach((e=>{e.oldValue?.includes(this.movingClassName)?(this.currOutOfSceneAnim?.pause(),this.observer.disconnect()):e.target.classList.contains(this.movingClassName)&&this.outOfScene()}))}))}static drawWheels(e){const t=new Image;t.src=d.CAR_WHEEL_IMG_SRC,t.onload=()=>{t.classList.add(o.default["car-div__wheel"]);const s=i.OBJ_PROCESSOR.deepClone(t);t.classList.add(o.default["car-div__wheel_forward"]),s.classList.add(o.default["car-div__wheel_backward"]),e.append(t),e.append(s)}}updateData(e){this._currCar=e,d.drawCar(this.canvas,this._currCar.color),this._spanCarName.textContent=`${this.index}: ${e.name}`}async rollBack(e=Promise.resolve()){return new Promise((t=>{(async()=>{this.isReseted||(this.observer.disconnect(),await this.playOutAnim(),this.currOutOfSceneAnim&&(this.currOutOfSceneAnim.cancel(),this.clearAnimFromElem(this.currOutOfSceneAnim),this.currOutOfSceneAnim=void 0),this.currAnimation&&(await this.stop(),this.currAnimation.playbackRate=-10,this.currAnimation.play(),console.log(`wait curr anim ${this.index}`),await this.currAnimation.finished,this.clearAnimFromElem(this.currAnimation),this.currAnimation=void 0,this._rootElement.classList.remove(o.default["car-div_rollForward"])),this._rootElement.style.removeProperty("transition"),this._rootElement.style.removeProperty("transform"),await this.playInAnim(),this._rootElement.style.removeProperty("opacity"),e.finally((()=>{this.btnStart$.disabled=!1,this.btnReset$.disabled=!0,this.btnRm$.disabled=!1,this.btnSelect$.disabled=!1}))),console.log(`reseted ${this.index}`),this.isReseted=!0,t(!0)})()}))}async playOutAnim(){const e=this._rootElement.animate([{opacity:"0.5"},{opacity:"0.9"},{opacity:"0.3"},{opacity:"0.7"},{opacity:"0.1"},{opacity:"0.4"},{opacity:"0"}],{duration:300,easing:"linear",fill:"forwards"});await e.finished,this.clearAnimFromElem(e)}async playAwaitingAnim(e){const t=this._rootElement.animate([{opacity:"0"},{opacity:"0.6"},{opacity:"0.3"},{opacity:"0.8"},{opacity:"0.3"},{opacity:"0.6"},{opacity:"0"}],{duration:400,easing:"linear",fill:"forwards",iterations:Number.POSITIVE_INFINITY});await e.finally((()=>{t.cancel(),this.clearAnimFromElem(t)}))}async playInAnim(){const e=this._rootElement.animate([{opacity:"0"},{opacity:"0.6"},{opacity:"0.3"},{opacity:"0.8"},{opacity:"0.5"},{opacity:"1"}],{duration:300,easing:"linear",fill:"forwards"});await e.finished,this.clearAnimFromElem(e)}outOfScene(){this.isReseted=!1,this.currOutOfSceneAnim=this._rootElement.animate([{transform:"translateX(-1000%)"}],{duration:3600,easing:"ease-in",fill:"forwards"})}disableCtls(){this.btnStart$.disabled=!0,this.btnRm$.disabled=!0,this.btnSelect$.disabled=!0,this.btnReset$.disabled=!0}async rollForward(e,t=!0){return this.isReseted=!1,new Promise(((s,a)=>{t&&(this.btnStart$.disabled=!0,this.btnRm$.disabled=!0,this.btnSelect$.disabled=!0,this.btnReset$.disabled=!1);const r=window.getComputedStyle(this._rootElement.parentElement),n=window.getComputedStyle(this.rootElement),i=Number.parseFloat(r.width)-Number.parseFloat(r.paddingLeft)-Number.parseFloat(r.paddingRight),c=Number.parseFloat(n.width),d=(i-c)/c*100;this._rootElement.classList.add(o.default["car-div_rollForward"]),this.currAnimation=this._rootElement.animate([{transform:`translateX(${d}%)`}],{duration:1e3*e*1.5,easing:"ease-in-out",fill:"forwards"}),this.currAnimation.onfinish=()=>{s(!0)},this.currAnimation.oncancel=()=>{this._rootElement.classList.remove(o.default["car-div_rollForward"]),a()}}))}async stop(e=!0,t=!1,s){if(e&&await new Promise((e=>{"running"===this.currAnimation?.playState?(this.currAnimation.addEventListener("finish",(()=>e(!0))),this.currAnimation.addEventListener("cancel",(()=>e(!0)))):e(!0)})),this._rootElement.classList.remove(o.default["car-div_rollForward"]),this.currAnimation?.pause(),t){if(s){const e=s.roadElem,t=e.classList.contains(this.movingClassName);console.log(`CHECK IF ROAD IS MOVING ${this.index}`),t&&this.outOfScene(),this.observer.observe(e,{attributes:!0,attributeOldValue:!0})}console.log(`exp anim ${this.index}`);const e=new Image;let t=0;e.classList.add(o.default["car-div__explosion"]),e.src=`${d.CAR_EXPLOSION_IMG_DATA.BASE_URL}${t}${d.CAR_EXPLOSION_IMG_DATA.EXTENSION}`,e.onload=async()=>{this._rootElement.append(e),await new Promise((e=>setTimeout(e,d.CAR_EXPLOSION_IMG_DATA.FRAME_TIME_MS))),t++,t<d.CAR_EXPLOSION_IMG_DATA.FRAMES_COUNT?e.src=`${d.CAR_EXPLOSION_IMG_DATA.BASE_URL}${t}${d.CAR_EXPLOSION_IMG_DATA.EXTENSION}`:e.remove()}}}get currCar(){return this._currCar}get btnSelect(){return this.btnSelect$}get btnRm(){return this.btnRm$}get btnStart(){return this.btnStart$}get btnReset(){return this.btnReset$}get spanCarName(){return this._spanCarName}static drawCar(e,t){const s=new Image;s.src=d.CAR_BODY_IMG_SRC,s.onload=()=>{e.height=s.height/3,e.width=s.width/3;const a=e.getContext("2d");a&&(a.shadowColor=t,a.shadowBlur=25,a.drawImage(s,0,0,e.width,e.height)),d.paintCarBody(e,t)}}static paintCarBody(e,t){const s=e.getContext("2d")?.getImageData(0,0,e.width,e.height);if(s){const a=n.hexToRgb(t);for(let e=0;e<s.width;e++)for(let t=0;t<s.height;t++){const r=4*t*s.width+4*e,n=s.data[r],i=s.data[r+1],o=s.data[r+2],c=2*o-n-i,d=10,l=70;n>l&&i>l&&o>l&&c<d&&(s.data[r]=n/255*a.r,s.data[r+1]=i/255*a.g,s.data[r+2]=o/255*a.b)}e.getContext("2d")?.putImageData(s,0,0,0,0,e.width,e.height)}}static genPreview(e){const t=document.createElement("div"),s=document.createElement("canvas");return s.classList.add(o.default["car-div__canvas"]),t.append(s),d.drawWheels(t),d.drawCar(s,e.color),t}}t.CarComp=d,d.TIMING_FUNCTION="cubic-bezier(.72,.2,.54,.77)",d.CAR_BODY_IMG_SRC="./assets/imgs/cars/body.gif",d.CAR_WHEEL_IMG_SRC="./assets/imgs/cars/tire back.gif",d.CAR_EXPLOSION_IMG_DATA={BASE_URL:"./assets/imgs/cars/explosion/",EXTENSION:".png",FRAMES_COUNT:9,FRAME_TIME_MS:200}},4312:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CreateCompController=void 0;const a=s(745),r=s(379),n=s(9237),i=s(8982);class o extends i.CreateUpdateCompControllerProto{constructor(e){super(e.inputText,e.inputColor,e.btn),this.txs=new Set,this.setupBtnCreate()}setupBtnCreate(){this.btn.addEventListener("click",(()=>{this.btn.disabled=!0;const e={name:this.inputText.value,color:this.inputColor.value};r.REST_CLIENT_GARAGE.createCar(e).then((e=>{const t=new n.DBusMsgCarActionCreatedMsg(e);this.txs.forEach((e=>{e.transmit({msg:t,prepMode:a.DBusTXPrepModes.clone,waitMode:a.DBusTXWaitModes.nowait})}))})).finally((()=>{this.btn.disabled=!1}))}))}autoConnect(e){const t=e.getNewTX("send created car msgs");this.txs.add(t)}}t.CreateCompController=o},8982:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CreateUpdateCompControllerProto=void 0,t.CreateUpdateCompControllerProto=class{constructor(e,t,s){this.inputText=e,this.inputColor=t,this.btn=s}toogleCtlsDisabled(e){this.inputText.disabled=e,this.inputColor.disabled=e,this.btn.disabled=e}}},2477:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateCompController=void 0;const a=s(5094),r=s(4690),n=s(379),i=s(6911),o=s(8982);class c extends o.CreateUpdateCompControllerProto{constructor(e){super(e.inputText,e.inputColor,e.btn),this.rxs=new Set,this.chooseCarListener=async e=>{console.log(e),e.msg instanceof i.DBusMsgCarActionSelectedMsg&&(this.choosedCar=a.OBJ_PROCESSOR.deepClone(e.msg.car),this.notifyCb=e.msg.notifyChanges,this.inputColor.value=e.msg.car.color,this.inputText.value=e.msg.car.name,this.toogleCtlsDisabled(!1))},this.setupBtnUpdate()}autoConnect(e){const t=e.getNewRX(this.chooseCarListener,"listen car choosing");e.plugRX(r.DBusTopics.CAR_ACTION,t)}setupBtnUpdate(){this.toogleCtlsDisabled(!0),this.btn.addEventListener("click",(()=>{this.toogleCtlsDisabled(!0),this.choosedCar&&(this.choosedCar.color=this.inputColor.value,this.choosedCar.name=this.inputText.value,n.REST_CLIENT_GARAGE.updateCar(this.choosedCar).then((e=>{this.notifyCb&&this.notifyCb(e)})).finally((()=>{this.toogleCtlsDisabled(!1)})))}))}}t.UpdateCompController=c},3525:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateUpdateComponent=void 0;const r=s(1168),n=s(5856),i=s(4312),o=s(2477),c=a(s(2022)),d=a(s(6725));class l extends r.BaseComp{constructor(e,t){super("div"),this.hubName=n.DBUS_HUB_NAMES.CREATE_UPDATE,this.textInput=document.createElement("input"),this.colorInput=document.createElement("input"),this.btn=document.createElement("button"),this._rootElement.classList.add(c.default.root),this.textInput.type="text",this.textInput.classList.add(c.default["text-input"]),this.colorInput.type="color",this.colorInput.classList.add(c.default["color-input"]),this.btn.textContent=t,this.btn.classList.add(d.default.btn),this._rootElement.append(this.textInput,this.colorInput,this.btn);const s={inputText:this.textInput,inputColor:this.colorInput,btn:this.btn};switch(e){case"UPDATE":this.controller=new o.UpdateCompController(s),this.btn.classList.add(d.default["btn-13"]);break;case"CREATE":default:this.controller=new i.CreateCompController(s),this.btn.classList.add(d.default["btn-13"])}}connect(e){this.controller.autoConnect(e)}}t.CreateUpdateComponent=l},3173:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgGenerateCarsMsg=void 0;const a=s(4690),r=s(7469);class n extends r.DBusMsg{constructor(e,t,s){super(a.DBusTopics.GENERATE,t,s),this.status=e,this.rxIds=t,this.prefResponseRxIds=s}}t.DBusMsgGenerateCarsMsg=n},44:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MainControlsComp=void 0;const r=s(1168),n=s(3525),i=s(5856),o=s(8381),c=s(745),d=s(3102),l=a(s(7715)),h=a(s(6725)),u=s(379),p=s(9653),_=s(4590),E=s(928),g=s(2994),m=s(3018),R=s(4690),C=s(3173),b=s(1011);class f extends r.BaseComp{constructor(){super("div"),this.hubName=i.DBUS_HUB_NAMES.MAIN_CONTROLS,this.txs=new Set,this.createComponent=new n.CreateUpdateComponent("CREATE","create"),this.updateComponent=new n.CreateUpdateComponent("UPDATE","update"),this.btnRace=document.createElement("button"),this.btnReset=document.createElement("button"),this.btnGenerate=document.createElement("button"),this.popup=new b.PopupStandaloneModalProgressComp,this.generateClickListener=async()=>{this.btnGenerate.disabled=!0;const e=new C.DBusMsgGenerateCarsMsg("start"),t=[];this.txs.forEach((s=>{const a=s.transmit({msg:e,prepMode:c.DBusTXPrepModes.freeze,waitMode:c.DBusTXWaitModes.allSetled});t.push(a)})),await Promise.allSettled(t),this.popup.reset().setText("please wait while the entries are generated").show(),await this.generate(100,void 0,this.genCb),this.popup.reset().hide();const s=new C.DBusMsgGenerateCarsMsg("end");this.txs.forEach((e=>{e.transmit({msg:s,prepMode:c.DBusTXPrepModes.freeze,waitMode:c.DBusTXWaitModes.nowait})})),this.btnGenerate.disabled=!1},this.genCb=e=>{this.popup.setProgress(e)},this.raceClickListener=async()=>{if(0===this.txs.size)return;this.btnRace.disabled=!0,this.btnGenerate.disabled=!0;const e=new o.DBusMsgRaceRequestMsg;this.txs.forEach((t=>{t.transmit({msg:e,prepMode:c.DBusTXPrepModes.freeze,waitMode:c.DBusTXWaitModes.allSetled})}))},this.resetClickListener=async()=>{if(0===this.txs.size)return;const e=new d.DBusMsgGarageResetReqMsg;this.txs.forEach((t=>{t.transmit({msg:e,prepMode:c.DBusTXPrepModes.freeze,waitMode:c.DBusTXWaitModes.allSetled})}))},this.genRandomCarName=()=>{const e=_.getRandomInt(p.CAR_MODEL_LIST_KEYS.length-1),t=p.CAR_MODEL_LIST_KEYS[e],s=p.CAR_MODEL_LIST[t];return`${t} ${s[_.getRandomInt(s.length-1)]}`},this.rxFuncForRaceMsgs=async e=>{if(e.msg instanceof m.DBusMsgGarageRaceStatusMsg){const{status:t}=e.msg;switch(t){case"READY_TO_GO":this.btnRace.disabled=!1,this.btnReset.disabled=!0,this.btnGenerate.disabled=!1;break;case"IN_PROCESS":this.btnRace.disabled=!0,this.btnReset.disabled=!1,this.btnGenerate.disabled=!0;break;case"NEED_RESET":this.btnRace.disabled=!0,this.btnReset.disabled=!1,this.btnGenerate.disabled=!1}}return g.DBUS_COMMON_RESPONSES.VOID},this._rootElement.classList.add(l.default["main-controls"]);const e=this.renderBtns();this.btnRace.addEventListener("click",this.raceClickListener),this.btnReset.addEventListener("click",this.resetClickListener),this.btnGenerate.addEventListener("click",this.generateClickListener),this.btnReset.disabled=!0,this.btnRace.disabled=!0,this._rootElement.append(this.createComponent.rootElement,this.updateComponent.rootElement,e)}renderBtns(){const e=document.createElement("span");e.textContent="race",this.btnRace.append(e),this.btnRace.classList.add(h.default.btn,h.default["btn-15"]),this.btnReset.textContent="reset",this.btnReset.classList.add(h.default.btn,h.default["btn-9"]),this.btnGenerate.textContent="generate cards",this.btnGenerate.classList.add(h.default.btn,h.default["btn-1"]);const t=document.createElement("div");return t.classList.add(l.default["btn-block"]),t.append(this.btnRace,this.btnReset,this.btnGenerate),t}async generate(e,t,s){let a=t||e;const r={name:this.genRandomCarName(),color:_.genRandomHexColor()},n={id:(await u.REST_CLIENT_GARAGE.createCar(r)).id,wins:_.getRandomArbitraryInt(1,3),time:Number.parseFloat((_.getRandomArbitraryInt(40,50)/3).toFixed(2))};return await E.REST_CLIENT_WINNERS.createWinner(n),a--,s&&s(100*(1-a/e)),!(a>0)||this.generate(e,a,s)}connect(e){e.attachSubHub(this.createComponent,"cu_create"),e.attachSubHub(this.updateComponent,"cu_delete");const t=e.getNewRX(this.rxFuncForRaceMsgs,"toggle btns in main-ctls-block");e.plugRX(R.DBusTopics.GARAGE,t);const s=e.getNewTX("start race | broadcast generate");this.txs.add(s)}}t.MainControlsComp=f},6670:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GaragePopupWinner=void 0;const a=s(1168);class r extends a.BaseComp{constructor(){super("div"),this.header=document.createElement("h3"),this.textTime=document.createElement("span"),this.textName=document.createElement("span"),this.textId=document.createElement("span"),this.textNumber=document.createElement("span"),this.header.textContent="WE HAVE A WINNER!",this._rootElement.append(this.header,this.textTime,this.textName,this.textId,this.textNumber)}setData(e,t,s){this.textTime.textContent=`Time: ${t}s`,this.textName.textContent=`Name of the car: \n ${e.name}`,this.textId.textContent=`ID of the car: ${e.id}`,this.textNumber.textContent=s?`Position on the track: ${s}`:""}}t.GaragePopupWinner=r},1598:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TrackComp=void 0;const r=s(1168),n=a(s(2096));class i extends r.BaseComp{constructor(){super("div"),this.topBlock=document.createElement("div"),this.illuminateSelf=e=>{e?this._rootElement.classList.add(n.default.track_illuminated):this._rootElement.classList.remove(n.default.track_illuminated)},this._rootElement.classList.add(n.default.track),this._rootElement.append(),this.topBlock.classList.add(n.default["track__controls-block"])}placeCar(e){this._rootElement.hasChildNodes()&&this._rootElement.childNodes.forEach((e=>e.remove())),this.topBlock.append(e.spanCarName),this._rootElement.append(this.topBlock,e.rootElement)}}t.TrackComp=i},4977:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HeaderComponent=void 0;const r=s(1168),n=s(2994),i=s(5856),o=s(4690),c=s(7950),d=a(s(3544)),l=s(9546);class h extends r.BaseComp{constructor(e=i.DBUS_HUB_NAMES.HEADER){super("header"),this.hubName=e,this.buses=[],this.illuminateNavItem=async e=>{const{msg:t}=e;return t instanceof c.DBusMsgRouteIsChangedMsg&&this.anchors.forEach((e=>{e.getAttribute("href")===t.newRoute?e.classList.add(d.default["header-nav__anchor_active"]):e.classList.remove(d.default["header-nav__anchor_active"])})),n.DBUS_COMMON_RESPONSES.VOID},this.rootElement.classList.add(d.default.header),this.logo=document.createElement("h1"),this.logo.classList.add(d.default.header__logo);const t=document.createElement("span");t.textContent="async";const s=document.createElement("span");s.textContent="race",this.logo.append(t,s),this.rootElement.append(this.logo),this.navContainer=document.createElement("nav"),this.navContainer.classList.add(d.default["header-nav"]),this.rootElement.append(this.navContainer);const a=document.createElement("ul");a.classList.add(d.default["header-nav__list"]),this.navContainer.append(a);const r={li:d.default["header-nav__item"],a:d.default["header-nav__anchor"],svg:d.default["header-nav__svg"],span:d.default["header-nav__span"]},o=[new l.NavItem("garage","#garage",r),new l.NavItem("winners","#winners",r)];this.anchors=o.map((e=>e.anchor)),a.append(...o.map((e=>e.rootElement)))}connect(e){const t=e.getNewRX(this.illuminateNavItem,"illuminate nav items");e.plugRX(o.DBusTopics.ROUTING,t)}}t.HeaderComponent=h},9546:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NavItem=void 0;const a=s(1168);class r extends a.BaseComp{constructor(e,t,s,a){super("li"),s?.li&&this._rootElement.classList.add(s.li),this._anchor=document.createElement("a"),this._anchor.setAttribute("href",t),s?.a&&this._anchor.classList.add(s.a),a&&(this.iconImage=document.createElement("img"),this.iconImage.src=a,s?.svg&&this.iconImage.classList.add(s.svg),this._anchor.append(this.iconImage)),this.span=document.createElement("span"),this.span.textContent=e,s?.span&&this.span.classList.add(s.span),this._anchor.append(this.span),this.rootElement.append(this._anchor)}get anchor(){return this._anchor}}t.NavItem=r},8655:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WinnerRowComp=void 0;const a=s(1168),r=s(8990);class n extends a.BaseComp{constructor(e,t,s){super("tr"),this.indexElem=document.createElement("td"),this.idElem=document.createElement("td"),this.carPreviewBox=document.createElement("td"),this.nameElem=document.createElement("td"),this.winsElem=document.createElement("td"),this.bestTimeElem=document.createElement("td"),this.indexElem.textContent=e.toString(),this.idElem.textContent=t.id.toString(),this.carPreview=r.CarComp.genPreview(s),this.carPreviewBox.append(this.carPreview),this.nameElem.textContent=s.name,this.winsElem.textContent=t.wins.toString(),this.bestTimeElem.textContent=t.time.toString(),this._rootElement.append(this.indexElem,this.idElem,this.carPreviewBox,this.nameElem,this.winsElem,this.bestTimeElem)}getCarPreview(){return this.carPreview}}t.WinnerRowComp=n},3287:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WinnersComp=void 0;const r=s(1168),n=s(379),i=s(928),o=s(5474),c=s(8655),d=s(7612),l=a(s(9052)),h=a(s(6725));class u extends r.BaseComp{constructor(){super("section"),this.table=document.createElement("table"),this.tableBody=document.createElement("tbody"),this.tableHead=document.createElement("thead"),this.thId=document.createElement("th"),this.thCar=document.createElement("th"),this.thName=document.createElement("th"),this.thWins=document.createElement("th"),this.thBestTime=document.createElement("th"),this.currOrder="DESC",this.currSort="wins",this.entriesPerPage=10,this.pagerCallback=async e=>{try{return await this.refillTable(void 0,void 0,e),!0}catch{return!1}},this.tableHeadClickListener=async e=>{let t;switch(e.target){case this.thId:t=o.REST_CLIENT_WINNERS_SORT_OPTIONS.id;break;case this.thWins:t=o.REST_CLIENT_WINNERS_SORT_OPTIONS.wins;break;case this.thBestTime:t=o.REST_CLIENT_WINNERS_SORT_OPTIONS.time}if(t){const s=e.target;this.currOrder=s.classList.contains(l.default["table__sorted-elem_desc"])?"ASC":"DESC",this.currSort=t,await this.refillTable(),this.refreshTableHeader(s)}},this.refreshTableHeader=e=>{this.currSortedElem&&this.currSortedElem.classList.remove(l.default["table__sorted-elem"]),e.classList.add(l.default["table__sorted-elem"]),this.currSortedElem=e,"ASC"===this.currOrder?(e.classList.remove(l.default["table__sorted-elem_desc"]),e.classList.add(l.default["table__sorted-elem_asc"])):(e.classList.remove(l.default["table__sorted-elem_asc"]),e.classList.add(l.default["table__sorted-elem_desc"]))},this._rootElement.classList.add(l.default.winners),this._rootElement.style.setProperty("background-image","url('./assets/imgs/backgrounds/winners/anime-girl-cyberpunk-ride-4k-lx-2880x1800.jpg')");const e=document.createElement("div");e.classList.add(l.default.pager),this.pager=new d.Pager(this.entriesPerPage,this.pagerCallback);const t=this.pager.getBtnPrevPage(),s=this.pager.getBtnNextPage();t.classList.add(h.default.btn,h.default["btn-6"],l.default["pager-btn"]),s.classList.add(h.default.btn),s.classList.add(h.default.btn,h.default["btn-6"],l.default["pager-btn"]),e.append(t,s);const a=this.pager.getPagerSpan();a.classList.add(l.default["pager-span"]),this.table.append(this.tableHead,this.tableBody,e,a),this.table.classList.add(l.default.table),this._rootElement.append(this.table),this.renderHeader(),this.refillTable().then((()=>this.refreshTableHeader(this.thBestTime)))}notify(){this.refillTable(this.currSort,this.currOrder).then((()=>this.refreshTableHeader(this.currSortedElem||this.thBestTime)))}renderHeader(){const e=document.createElement("tr"),t=document.createElement("th");t.textContent="â„–",this.thId.textContent="ID",this.thId.classList.add(l.default["table__can-be-sorted"]),this.thCar.textContent="CAR",this.thName.textContent="NAME",this.thWins.textContent="WINS",this.thWins.classList.add(l.default["table__can-be-sorted"]),this.thBestTime.textContent="BEST TIME",this.thBestTime.classList.add(l.default["table__can-be-sorted"]),e.append(t,this.thId,this.thCar,this.thName,this.thWins,this.thBestTime),this.tableHead.append(e),this.tableHead.addEventListener("click",this.tableHeadClickListener)}async refillTable(e,t,s){return new Promise(((a,r)=>{const o=s?"next"===s?this.pager.getCurrPageNumber()+1:this.pager.getCurrPageNumber()-1:this.pager.getCurrPageNumber(),d=t||this.currOrder,h=e||this.currSort;i.REST_CLIENT_WINNERS.getWinners(o,10,h,d).then((async e=>{if(this.pager.setEntriesCount(Number.parseInt(e.limit,10)),0===e.cars.length)return void r();const t=new Array(e.cars.length),s=[],i=10*(o-1);for(e.cars.forEach(((e,a)=>{const r=n.REST_CLIENT_GARAGE.getCar(e.id).then((s=>{const r=a+i+1,n=new c.WinnerRowComp(r,e,s);t[a]=n}));s.push(r)})),await Promise.allSettled(s);this.tableBody.firstChild;)this.tableBody.firstChild.remove();this.tableBody.append(...t.map((e=>(e.getCarPreview().classList.add(l.default["table__car-preview-box"]),e.rootElement)))),a(!0)}))}))}}t.WinnersComp=u,u.TEXT_CONTENT_ENG={}},9653:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CAR_MODEL_LIST_KEYS=t.CAR_MODEL_LIST=void 0;const a=s(5094),r=a.OBJ_PROCESSOR.deepFreeze({Lamborghini:["MurciÃ©lago","350 GT","400 GT","SiÃ¡n FKP 37","Essenza SCV12","Urus","Centenario","HuracÃ¡n","Veneno","Sesto ElementÐ¾","Aventador","ReventÃ³n","Gallardo","Diablo","LM002","Jalpa","Silhouette","Countach","Urraco","Jarama","Islero","Espada","Miura"],"Aston Martin":["Project 003","Valkyrie","DBS","Vanquish Zagato","Vanquish","Virage/Virage Volante","V12 Zagato","One-77","V8 Coupe/V8 Volante","V8 Zagato"],Ferrari:["Roma","Portfolio","488 GTB","California T","360 Spider","355 F1 Berlinetta","F355 GTS","456 GT","Testarossa","SF1000"],Koenigsegg:["Jesko Absolut","Jesko","Agera Final","Agera XS","Agera X","Agera S","Regera","Agera RS","One:1","CCGT"]});t.CAR_MODEL_LIST=r;const n=a.OBJ_PROCESSOR.deepFreeze(Object.keys(r));t.CAR_MODEL_LIST_KEYS=n},1168:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseComp=void 0,t.BaseComp=class{constructor(e="div"){this._rootElement=document.createElement(e)}get rootElement(){return this._rootElement}}},2841:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PopupStandaloneModal404Comp=void 0;const r=s(8743),n=a(s(6725));class i extends r.PopupStandaloneModalComp{constructor(){super(),this.header.textContent="ERROR: 404",this.header.dataset.textContent=this.header.textContent,this.header.classList.add(n.default["glitched-text"]),this.text.classList.add(n.default["glitched-text"])}}t.PopupStandaloneModal404Comp=i},8743:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PopupStandaloneModalComp=void 0;const r=s(3213),n=a(s(3588));class i extends r.PopupStandaloneComp{constructor(){super(),this._rootElement.classList.add(n.default["popup-modal"]);const e=document.createElement("div");e.classList.add(n.default["popup-bg"]),this._rootElement.append(e),this.body.classList.add(n.default["popup-body"]),e.append(this.body),this.header.classList.add(n.default["popup-body-header"]),this.text.classList.add(n.default["popup-body-text"])}setText(e){return this.text.textContent=e,this.text.dataset.textContent=e,this}show(e){return(e||document.body).append(this._rootElement),this}hide(){return this._rootElement.remove(),this}}t.PopupStandaloneModalComp=i},1011:function(e,t,s){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PopupStandaloneModalProgressComp=void 0;const r=s(8743),n=a(s(9715)),i=a(s(6725));class o extends r.PopupStandaloneModalComp{constructor(){super(),this.barContainer=document.createElement("div"),this.bar=document.createElement("div"),this.barContainer.classList.add(n.default.container),this.bar.classList.add(n.default.bar),this.barContainer.append(this.bar),this.text.classList.add(n.default.text,i.default["glitched-text"]),this.body.classList.add(n.default.body),this.body.append(this.barContainer)}setText(e){return super.setText(e),this}reset(){return this.bar.style.removeProperty("--progress"),this.text.textContent="",this.text.dataset.textContent="",this}setProgress(e){return this.bar.style.setProperty("--progress",`${e}%`),this}}t.PopupStandaloneModalProgressComp=o},3213:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PopupStandaloneComp=void 0;const a=s(1168);class r extends a.BaseComp{constructor(){super("div"),this.body=document.createElement("div"),this.header=document.createElement("h3"),this.text=document.createElement("p"),this.body.append(this.header,this.text),this._rootElement.append(this.body)}}t.PopupStandaloneComp=r},9007:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hexToRgb=void 0,t.hexToRgb=function(e){let t;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return t=e.split(""),4===t.length&&(t=[t[1],t[1],t[2],t[2],t[3],t[3]]),{r:Number.parseInt(e.slice(1,3),16),g:Number.parseInt(e.slice(3,5),16),b:Number.parseInt(e.slice(5,7),16)};throw new Error("Bad Hex")}},4590:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.genRandomHexColor=t.getRandomArbitraryInt=t.getRandomInt=t.genUniqId=void 0,t.genUniqId=function(){const e=new Uint8Array(4);return window.crypto.getRandomValues(e).join("")},t.getRandomInt=function(e){return Math.floor(Math.random()*e)},t.getRandomArbitraryInt=function(e,t){return Math.floor(Math.random()*(t-e)+e)},t.genRandomHexColor=function e(){const t=`#${Math.floor(16777215*Math.random()).toString(16)}`;return 7===t.length?t:e()}},3662:(e,t)=>{function s(e,t){const s=e.getPropertyValue("transition-property").replace(",","").split(" ");let a=s.lastIndexOf(t);if(-1===a&&(a=s.lastIndexOf("all")),-1!==a)return e.getPropertyValue("transition-duration").replace(",","").split(" ")[a]}Object.defineProperty(t,"__esModule",{value:!0}),t.transitionPromise=t.getTransitionDuration=void 0,t.getTransitionDuration=s,t.transitionPromise=function(e){return new Promise((t=>{const a=s=>{e.val&&e.elem.style.setProperty(e.prop,e.val),setTimeout((()=>{t(!0)}),s||20)};if(e.forceAutoresolveIn)a(e.forceAutoresolveIn);else if(e.valToWait&&window.getComputedStyle(e.elem).getPropertyValue(e.prop)===e.valToWait)a();else{const r=s(window.getComputedStyle(e.elem),e.prop);r&&"0s"!==r?(()=>{const s=a=>{a.target===e.elem&&a.propertyName===e.prop&&(e.valToWait&&window.getComputedStyle(e.elem).getPropertyValue(e.prop)!==e.valToWait||(e.elem.removeEventListener("transitionend",s),e.elem.removeEventListener("transitionend",s),t(!0)))};e.elem.addEventListener("transitionend",s),e.elem.addEventListener("transitioncancel",s),e.val&&e.elem.style.setProperty(e.prop,e.val)})():a()}}))}},9630:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNotifiable=void 0,t.isNotifiable=function(e){return"notify"in e&&"function"==typeof e.notify}},5094:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OBJ_PROCESSOR=void 0;const s=new class{constructor(){this.deepFreeze=e=>{if("object"==typeof e&&null!==e){const t=e;return Object.keys(t).forEach((e=>{"object"!=typeof t[e]||Object.isFrozen(t[e])||this.deepFreeze(t[e])})),Object.freeze(e)}throw new Error("not object")},this.deepClone=e=>{if(Array.isArray(e)){const t=[];return e.forEach((e=>{t.push(e)})),t.map((e=>this.deepClone(e)))}if("object"==typeof e&&null!==e){if(e instanceof HTMLElement)return e.cloneNode(!0);if(e instanceof Blob)return e.slice();const t={...e};return Object.keys(t).forEach((e=>{t[e]=this.deepClone(t[e])})),Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}return e}}};t.OBJ_PROCESSOR=s,s.deepFreeze(s)},7172:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBus=void 0;const a=s(4590),r=s(5094),n=s(7247),i=s(492),o=s(8927),c=s(2606),d=s(745),l=s(4441),h=s(7656),u=s(5856);t.DBus=class{constructor(){return this.network=new Map,this.idCounter={txs:0,rxs:0},this.createdRXs=new Set,this.createdTXs=new Set,this.attachedHubs=new Map,this.occupiedNames=new Set,this.callRXFunc=(e,t)=>{switch(e.headers.prepMode){case d.DBusTXPrepModes.clone:return(()=>{const s=r.OBJ_PROCESSOR.deepClone(e);return t.func(s)})();case d.DBusTXPrepModes.freeze:return(()=>{const s=r.OBJ_PROCESSOR.deepFreeze(e);return t.func(s)})();default:throw new Error(n.DBUS_ERRORS.UNEXPECTED_PREP_MODE)}},this.busId=a.genUniqId(),Object.freeze(this)}attachHub(e,t){return this.createInterfaceForHub(e,void 0,t)}createInterfaceForHub(e,t,s){if(this.attachedHubs.has(e))throw new Error(n.DBUS_ERRORS.HUB_IS_ALREADY_ATTACHED);if(!(e.hubName in u.DBUS_HUB_NAMES))throw new Error(n.DBUS_ERRORS.HUB_NAME_NOT_AUTHORIZED);let a=t?`${t}_${e.hubName}`:e.hubName;if(s&&(a+=`_${s}`),this.occupiedNames.has(a))throw new Error(n.DBUS_ERRORS.HUB_NAME_IS_OCCUPIED);const i=new h.DBusInterface((e=>this.getNewTX(a,e)),((e,t)=>this.genNewRX(e,t)),((e,t)=>this.plugRX(e,t)),((e,t)=>this.unplugRX(e,t)),((e,t)=>this.createInterfaceForHub(e,a,t)));return this.occupiedNames.add(a),this.attachedHubs.set(e,i),r.OBJ_PROCESSOR.deepFreeze(i),e.connect(i)}getNewTX(e,t){const s=a.genUniqId(),n=this.idCounter.txs++,i=new o.DBusTX(n,s,this.busId,(async a=>{const r=new l.DBusTXDataHeaders(e,s,n,a.waitMode,a.prepMode,t),i=new c.DBusTXData(r,a.msg);return await this.transmit(i)})),d=r.OBJ_PROCESSOR.deepFreeze(i);return this.createdTXs.add(d),d}genNewRX(e,t){const s=a.genUniqId(),n=this.idCounter.rxs++,o=new i.DBusRX(n,s,this.busId,e,t),c=r.OBJ_PROCESSOR.deepFreeze(o);return this.createdRXs.add(c),c}plugRX(e,t){if(!this.createdRXs.has(t))throw new Error(n.DBUS_ERRORS.XENO_RX);this.network.has(e)||this.network.set(e,new Set),this.network.get(e)?.add(t)}unplugRX(e,t){this.network.get(e)?.delete(t)}async transmit(e){if(!this.network.has(e.msg.topic))throw new Error(n.DBUS_ERRORS.TOPIC_IS_NOT_EXIST);const t=this.network.get(e.msg.topic);if(void 0===t||0===t.size)throw new Error(n.DBUS_ERRORS.TOPIC_HAS_NO_RXS);let s,a=[];if(e.msg.prefResponseRxIds){if(t.forEach((t=>{e.msg.prefResponseRxIds?.includes(t.id)&&a.push(t)})),0===a.length)throw new Error(n.DBUS_ERRORS.PREF_RXS_ARE_NOT_EXIST)}else a=[...t];switch(e.headers.waitMode){case d.DBusTXWaitModes.all:s=await Promise.all(a.map((t=>this.callRXFunc(e,t))));break;case d.DBusTXWaitModes.allSetled:s=await Promise.allSettled(a.map((t=>this.callRXFunc(e,t))));break;case d.DBusTXWaitModes.manual:s=a;break;case d.DBusTXWaitModes.nowait:default:a.map((t=>this.callRXFunc(e,t))),s=!0}return s}}},2994:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBUS_COMMON_RESPONSES=void 0;const a=s(5094).OBJ_PROCESSOR.deepFreeze({VOID:"VOID",BAD_REQUEST:"BAD_REQUEST"});t.DBUS_COMMON_RESPONSES=a},7247:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBUS_ERRORS=void 0;const a=s(5094).OBJ_PROCESSOR.deepFreeze({HUB_NAME_IS_OCCUPIED:"HUB_NAME_IS_OCCUPIED",HUB_IS_ALREADY_ATTACHED:"HUB_IS_ALREADY_ATTACHED",HUB_NAME_NOT_AUTHORIZED:"HUB_NAME_NOT_AUTHORIZED",XENO_RX:"XENO_RX",TOPIC_IS_NOT_EXIST:"TOPIC_IS_NOT_EXIST",TOPIC_HAS_NO_RXS:"TOPIC_HAS_NO_RXS",PREF_RXS_ARE_NOT_EXIST:"PREF_RXS_ARE_NOT_EXIST",UNEXPECTED_PREP_MODE:"UNEXPECTED_PREP_MODE"});t.DBUS_ERRORS=a},5856:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBUS_HUB_NAMES=void 0;const a=s(5094),r=new class{constructor(){this.APP="APP",this.ROUTER="ROUTER",this.GARAGE="GARAGE",this.HEADER="HEADER",this.MAIN_CONTROLS="MAIN_CONTROLS",this.CREATE_UPDATE="CREATE_UPDATE",this.GARAGE_CONTROLLER="GARAGE_CONTROLLER"}},n=a.OBJ_PROCESSOR.deepFreeze(r);t.DBUS_HUB_NAMES=n},7656:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusInterface=t.isDBusHub=void 0;const a=s(5856);t.isDBusHub=function(e){const t=e;return"connect"in t&&"hubName"in t&&"string"==typeof t.hubName&&t.hubName in a.DBUS_HUB_NAMES},t.DBusInterface=class{constructor(e,t,s,a,r){this.arrowedGetNewTX=e,this.arrowedGetNewRX=t,this.arrowedPlugRX=s,this.arrowedUnplugRX=a,this.attachSubHub=r,this.RXs=new Set,this.TXs=new Set,this.RXsPlugMap=new Map}getNewRX(e,t){const s=this.arrowedGetNewRX(e,t);return this.RXs.add(s),s}getNewTX(e){const t=this.arrowedGetNewTX(e);return this.TXs.add(t),t}plugRX(e,t){this.RXsPlugMap.has(e)||this.RXsPlugMap.set(e,new Set),this.RXsPlugMap.get(e)?.add(t),this.arrowedPlugRX(e,t)}unplugRX(e,t){this.RXsPlugMap.get(e)?.delete(t),this.arrowedUnplugRX(e,t)}}},492:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusRX=void 0,t.DBusRX=class{constructor(e,t,s,a,r){this.regNumber=e,this.id=t,this.busId=s,this.func=a,this.desc=r}}},4690:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.DBusTopics=void 0,(s=t.DBusTopics||(t.DBusTopics={}))[s.ROUTING=0]="ROUTING",s[s.CAR_ACTION=1]="CAR_ACTION",s[s.GARAGE=2]="GARAGE",s[s.REST_CLIENT_REQUESTS=3]="REST_CLIENT_REQUESTS",s[s.GENERATE=4]="GENERATE"},4441:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusTXDataHeaders=void 0,t.DBusTXDataHeaders=class{constructor(e,t,s,a,r,n){this.hubName=e,this.txId=t,this.txRegNumber=s,this.waitMode=a,this.prepMode=r,this.txDesc=n}}},2606:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusTXData=void 0,t.DBusTXData=class{constructor(e,t){this.headers=e,this.msg=t}}},745:(e,t)=>{var s,a;Object.defineProperty(t,"__esModule",{value:!0}),t.DBusTXPrepModes=t.DBusTXWaitModes=void 0,(a=t.DBusTXWaitModes||(t.DBusTXWaitModes={}))[a.nowait=0]="nowait",a[a.all=1]="all",a[a.allSetled=2]="allSetled",a[a.manual=3]="manual",(s=t.DBusTXPrepModes||(t.DBusTXPrepModes={}))[s.clone=0]="clone",s[s.freeze=1]="freeze"},8927:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusTX=void 0,t.DBusTX=class{constructor(e,t,s,a){this.regNumber=e,this.id=t,this.busId=s,this.transmit=a}}},7469:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsg=void 0,t.DBusMsg=class{constructor(e,t,s){this.topic=e,this.rxIds=t,this.prefResponseRxIds=s}}},7612:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Pager=void 0,t.Pager=class{constructor(e,t,s=document.createElement("button"),a=document.createElement("button")){this.entriesPerPage=e,this.listCallback=t,this.btnPrevPage=s,this.btnNextPage=a,this.firstPageNumber=1,this.currPageNumber=this.firstPageNumber,this.lastPageNumber=0,this.pagerSpan=document.createElement("span"),this.entriesCount=0,this.callbackIsCalled=!1;const r=document.createElement("span");r.textContent="Next page",this.btnNextPage.append(r);const n=document.createElement("span");n.textContent="Prev page",this.btnPrevPage.append(n),this.btnNextPage.addEventListener("click",(()=>this.callCallback("next"))),this.btnPrevPage.addEventListener("click",(()=>this.callCallback("prev")))}toogleLock(e){this.toggleBtnsDisabled(e)}getEntriesPerPage(){return this.entriesPerPage}setLastPageNumber(e){this.lastPageNumber=e,this.callbackIsCalled||this.toggleBtnsDisabled(!1)}setEntriesCount(e){this.entriesCount=e,this.lastPageNumber=Math.ceil(this.entriesCount/this.entriesPerPage),this.pagerSpan.textContent=`Entries: ${e}, Pages: ${this.lastPageNumber}`,this.callbackIsCalled||this.toggleBtnsDisabled(!1)}getCurrPageNumber(){return this.currPageNumber}getBtnPrevPage(){return this.btnPrevPage}getBtnNextPage(){return this.btnNextPage}getPagerSpan(){return this.pagerSpan}tryChangePage(e){return this.callCallback(e)}async callCallback(e){if(this.callbackIsCalled=!0,this.toggleBtnsDisabled(!0),await this.listCallback(e))switch(e){case"next":this.currPageNumber++;break;case"prev":this.currPageNumber--}this.toggleBtnsDisabled(!1),this.callbackIsCalled=!1}toggleBtnsDisabled(e){if(!0===e)return this.btnPrevPage.disabled=!0,void(this.btnNextPage.disabled=!0);this.currPageNumber>this.firstPageNumber?this.btnPrevPage.disabled=!1:this.btnPrevPage.disabled=!0,this.currPageNumber<this.lastPageNumber?this.btnNextPage.disabled=!1:this.btnNextPage.disabled=!0}}},2623:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgRoutingMsg=void 0;const a=s(4690),r=s(7469);class n extends r.DBusMsg{constructor(e,t){super(a.DBusTopics.ROUTING,e,t)}}t.DBusMsgRoutingMsg=n},7950:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DBusMsgRouteIsChangedMsg=void 0;const a=s(2623);class r extends a.DBusMsgRoutingMsg{constructor(e,t,s){super(t,s),this.newRoute=e}}t.DBusMsgRouteIsChangedMsg=r},1209:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleRouterAgent=void 0,t.SimpleRouterAgent=class{constructor(e,t,s,a,r){this.type=e,this.path=t,this.callback=s,this.getStateCallback=a,this.setStateCallback=r}}},5207:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleRouter=void 0;const a=s(5094),r=s(5856),n=s(745),i=s(7950);t.SimpleRouter=class{constructor(e){switch(this.hubName=r.DBUS_HUB_NAMES.ROUTER,this.agents=new Set,this.txs=new Set,this.restrictions=new Set,e.mode){case"#":break;case"?":throw new Error(`${e.mode} is not supported yet!`);default:throw new Error(`${e.mode} is not supported!`)}this.options=a.OBJ_PROCESSOR.deepFreeze(e),window.addEventListener("popstate",(async()=>{if(window.location.href!==this.currRoute)if(this.restrictions.size>0){const e=window.location.href;this.currRoute?window.location.href=this.currRoute:this.options.defaultRoot&&(window.location.href=`${window.location.host}/${this.options.defaultRoot}`);const t=[...this.restrictions.values()],s=t.map((e=>e())),a=await Promise.all(s);let r=!1;if(Array.isArray(a))for(let e=0;e<a.length;e++){if("boolean"!=typeof a[e])throw new Error("restrict func returned not boolean value!");if(a[e]){const s=t[e];s&&this.restrictions.delete(s)}else r=!0}r||(window.location.href=e)}else this.activateWantedAgents()}))}activateWantedAgents(){this.currRoute=window.location.href;let e=0;const t=[];if(!this.options.onlyDBus&&"#"===this.options.mode){const s=[...this.agents];for(let t=0;t<this.agents.size;t++)if(s[t]?.path===window.location.hash){try{s[t]?.callback()}catch(e){e.push(e)}e++;break}0===e&&(this.defaultAgent&&this.options.defaultRoot===window.location.hash?this.defaultAgent.callback():t.push(new Error("Agent is not finded")))}return this.txs.size>0&&this.txs.forEach((e=>{const t=new i.DBusMsgRouteIsChangedMsg(window.location.hash);e.transmit({msg:t,waitMode:n.DBusTXWaitModes.nowait,prepMode:n.DBusTXPrepModes.freeze})})),t.length>0?t:e>0}addRouterAgent(e){this.agents.add(e)}removeRouterAgent(e){this.agents.delete(e)}flushRouterAgents(){this.agents.clear()}connect(e){const t=e.getNewTX("broadcasting route changes");this.txs.add(t)}}},9461:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REST_CLIENT_ENGINE=void 0;const a=s(5094),r=s(3231),n=new class{constructor(e){this.baseUrl=e,this.resUrl="/engine",this.fullUrl=e+this.resUrl}toggleEngine(e,t){return new Promise(((s,a)=>{const n=`${this.fullUrl}?id=${e}&status=${t}`;fetch(n,{method:"GET"}).then((e=>{if(200===e.status)return e.json();throw new Error(r.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>s(e))).catch((e=>{e.message in r.REST_CLIENT_ERROR&&a(e),"Failed to fetch"===e.message?a(new Error(r.REST_CLIENT_ERROR.CONNECTION_REFUSED)):a(r.REST_CLIENT_ERROR.UNKNOWN_ERROR)}))}))}enterDriveMode(e){return new Promise(((t,s)=>{const a=`${this.fullUrl}?id=${e}&status=drive`;fetch(a,{method:"GET"}).then((e=>{200===e.status?t(!0):500===e.status?t(!1):s(new Error(r.REST_CLIENT_ERROR.UNEXPECTED_RESULT))})).catch((e=>{e.message in r.REST_CLIENT_ERROR&&s(e),"Failed to fetch"===e.message?s(new Error(r.REST_CLIENT_ERROR.CONNECTION_REFUSED)):s(r.REST_CLIENT_ERROR.UNKNOWN_ERROR)}))}))}}("http://127.0.0.1:3000"),i=a.OBJ_PROCESSOR.deepFreeze(n);t.REST_CLIENT_ENGINE=i},379:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REST_CLIENT_GARAGE=void 0;const a=s(5094),r=s(3231),n=s(3748),i=new class{constructor(e){this.baseUrl=e,this.clientName=n.REST_CLIENT_NAMES.GARAGE,this.resUrl="/garage",this.fullUrl=e+this.resUrl}getCars(e,t){return new Promise(((s,a)=>{const n=t||"",i=`${this.fullUrl}?_page=${e}&_limit=${n}`;let o="";fetch(i,{method:"GET"}).then((e=>{if(200===e.status)return o=e.headers.get("X-Total-Count"),e.json();throw new Error(r.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>s({limit:o,cars:e}))).catch((e=>{e.message in r.REST_CLIENT_ERROR&&a(e),"Failed to fetch"===e.message?a(new Error(r.REST_CLIENT_ERROR.CONNECTION_REFUSED)):a(r.REST_CLIENT_ERROR.UNKNOWN_ERROR)}))}))}getCar(e){return new Promise(((t,s)=>{const a=`${this.fullUrl}/${e}`;fetch(a,{method:"GET"}).then((e=>{if(200===e.status)return e.json();if(404===e.status)throw new Error(r.REST_CLIENT_ERROR.NOT_FOUND);throw new Error(r.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>t(e))).catch((e=>{e.message in r.REST_CLIENT_ERROR&&s(e),"Failed to fetch"===e.message?s(new Error(r.REST_CLIENT_ERROR.CONNECTION_REFUSED)):s(r.REST_CLIENT_ERROR.UNKNOWN_ERROR)}))}))}createCar(e){return new Promise(((t,s)=>{fetch(this.fullUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(201===e.status)return e.json();throw new Error(r.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>t(e))).catch((e=>{e.message in r.REST_CLIENT_ERROR&&s(e),"Failed to fetch"===e.message?s(new Error(r.REST_CLIENT_ERROR.CONNECTION_REFUSED)):s(r.REST_CLIENT_ERROR.UNKNOWN_ERROR)}))}))}deleteCar(e){return new Promise(((t,s)=>{const a=`${this.fullUrl}/${e}`;fetch(a,{method:"DELETE"}).then((e=>{if(200===e.status&&t(!0),404===e.status)throw new Error(r.REST_CLIENT_ERROR.NOT_FOUND);throw new Error(r.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).catch((e=>{e.message in r.REST_CLIENT_ERROR&&s(e),"Failed to fetch"===e.message?s(new Error(r.REST_CLIENT_ERROR.CONNECTION_REFUSED)):s(r.REST_CLIENT_ERROR.UNKNOWN_ERROR)}))}))}updateCar(e){return new Promise(((t,s)=>{const a=`${this.fullUrl}/${e.id}`,n=e;fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>{if(200===e.status)return e.json();if(404===e.status)throw new Error(r.REST_CLIENT_ERROR.NOT_FOUND);throw new Error(r.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>t(e))).catch((e=>{e.message in r.REST_CLIENT_ERROR&&s(e),"Failed to fetch"===e.message?s(new Error(r.REST_CLIENT_ERROR.CONNECTION_REFUSED)):s(r.REST_CLIENT_ERROR.UNKNOWN_ERROR)}))}))}}("http://127.0.0.1:3000"),o=a.OBJ_PROCESSOR.deepFreeze(i);t.REST_CLIENT_GARAGE=o},5474:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REST_CLIENT_WINNERS_SORT_OPTIONS=void 0;const a=s(5094),r=new class{constructor(){this.id="id",this.wins="wins",this.time="time"}},n=a.OBJ_PROCESSOR.deepFreeze(r);t.REST_CLIENT_WINNERS_SORT_OPTIONS=n},928:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REST_CLIENT_WINNERS=void 0;const a=s(5094),r=s(3231),n=new class{constructor(e){this.baseUrl=e,this.resUrl="/winners",this.fullUrl=e+this.resUrl}getWinners(e=0,t,s,a){return new Promise(((n,i)=>{const o=t||"";let c=`${this.fullUrl}?_page=${e}&_limit=${o}`;s&&(c+=`&_sort=${s}`),a&&(c+=`&_order=${a}`);let d="";fetch(c,{method:"GET"}).then((e=>{if(200===e.status)return d=e.headers.get("X-Total-Count"),e.json();throw new Error(r.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>n({limit:d,cars:e}))).catch((e=>{e.message in r.REST_CLIENT_ERROR&&i(e),"Failed to fetch"===e.message?i(new Error(r.REST_CLIENT_ERROR.CONNECTION_REFUSED)):i(r.REST_CLIENT_ERROR.UNKNOWN_ERROR)}))}))}getWinner(e){return new Promise(((t,s)=>{const a=`${this.fullUrl}/${e}`;fetch(a,{method:"GET"}).then((e=>{if(200===e.status)return e.json();if(404===e.status)throw new Error(r.REST_CLIENT_ERROR.NOT_FOUND);throw new Error(r.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>t(e))).catch((e=>{e.message in r.REST_CLIENT_ERROR&&s(e),"Failed to fetch"===e.message?s(new Error(r.REST_CLIENT_ERROR.CONNECTION_REFUSED)):s(r.REST_CLIENT_ERROR.UNKNOWN_ERROR)}))}))}createWinner(e){return new Promise(((t,s)=>{fetch(this.fullUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(201===e.status)return e.json();throw new Error(r.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>t(e))).catch((e=>{e.message in r.REST_CLIENT_ERROR&&s(e),"Failed to fetch"===e.message?s(new Error(r.REST_CLIENT_ERROR.CONNECTION_REFUSED)):s(r.REST_CLIENT_ERROR.UNKNOWN_ERROR)}))}))}deleteWinner(e){return new Promise(((t,s)=>{const a=`${this.fullUrl}/${e}`;fetch(a,{method:"DELETE"}).then((e=>{if(200===e.status&&t(!0),404===e.status)throw new Error(r.REST_CLIENT_ERROR.NOT_FOUND);throw new Error(r.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).catch((e=>{e.message in r.REST_CLIENT_ERROR&&s(e),"Failed to fetch"===e.message?s(new Error(r.REST_CLIENT_ERROR.CONNECTION_REFUSED)):s(r.REST_CLIENT_ERROR.UNKNOWN_ERROR)}))}))}updateWinner(e){return new Promise(((t,s)=>{const a=`${this.fullUrl}/${e.id}`,n=e;fetch(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>{if(200===e.status)return e.json();if(404===e.status)throw new Error(r.REST_CLIENT_ERROR.NOT_FOUND);throw new Error(r.REST_CLIENT_ERROR.UNEXPECTED_RESULT)})).then((e=>t(e))).catch((e=>{e.message in r.REST_CLIENT_ERROR&&s(e),"Failed to fetch"===e.message?s(new Error(r.REST_CLIENT_ERROR.CONNECTION_REFUSED)):s(r.REST_CLIENT_ERROR.UNKNOWN_ERROR)}))}))}}("http://127.0.0.1:3000"),i=a.OBJ_PROCESSOR.deepFreeze(n);t.REST_CLIENT_WINNERS=i},3231:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REST_CLIENT_ERROR=void 0;const a=s(5094).OBJ_PROCESSOR.deepFreeze({UNEXPECTED_RESULT:"UNEXPECTED_RESULT",UNKNOWN_ERROR:"UNKNOWN_ERROR",NOT_FOUND:"NOT_FOUND",CONNECTION_REFUSED:"CONNECTION_REFUSED"});t.REST_CLIENT_ERROR=a},3748:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.REST_CLIENT_NAMES=void 0;const a=s(5094),r=new class{constructor(){this.GARAGE="GARAGE",this.WINNERS="WINNERS"}};t.REST_CLIENT_NAMES=r,a.OBJ_PROCESSOR.deepFreeze(r)}},t={};function s(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,s),n.exports}s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{const e=s(6752);window.addEventListener("load",(()=>{const t=document.createElement("div");document.body.append(t),new e.App(t)}))})()})();
//# sourceMappingURL=main.780ab1ecff409078f274.js.map